<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор методических услуг 2.0</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
        }
        
        .form-section {
            padding: 40px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .result-section {
    background: #f8fafc;
    padding: 40px;
    border-left: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    max-height: 90vh;
    overflow-y: auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    gap: 20px;
}
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group label {
            font-weight: 600;
            color: #374151;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .info-card {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-card h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .info-card p {
            color: #0369a1;
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
        }

.mode-group {
            transition: all 0.3s ease;
        }
        
        .mode-group.hidden {
            display: none !important;
        }
        
        .complexity-hint {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 0.85rem;
            color: #6b7280;
            line-height: 1.4;
        }
        
        .preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .preset-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .preset-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .preset-item.active {
    /* Стили будут переопределены цветовым кодированием выше */
}

/* Цветовое кодирование пресетов при ховере */
.preset-item[data-preset="textLesson"]:hover {
    border-color: #64748b;
    background: rgba(59, 130, 246, 0.08);
}

.preset-item[data-preset="videoLesson"]:hover {
    border-color: #7c3aed;
    background: rgba(139, 92, 246, 0.08);
}

.preset-item[data-preset="webinar"]:hover {
    border-color: #be185d;
    background: rgba(236, 72, 153, 0.08);
}

.preset-item[data-preset="workshop"]:hover {
    border-color: #047857;
    background: rgba(16, 185, 129, 0.08);
}

.preset-item[data-preset="caseStudy"]:hover {
    border-color: #d97706;
    background: rgba(245, 158, 11, 0.08);
}

.preset-item[data-preset="masterClass"]:hover {
    border-color: #dc2626;
    background: rgba(239, 68, 68, 0.08);
}

/* Активное состояние с цветовым кодированием */
.preset-item[data-preset="textLesson"].active {
    border-color: #64748b;
    background: rgba(59, 130, 246, 0.12);
}

.preset-item[data-preset="videoLesson"].active {
    border-color: #7c3aed;
    background: rgba(139, 92, 246, 0.12);
}

.preset-item[data-preset="webinar"].active {
    border-color: #be185d;
    background: rgba(236, 72, 153, 0.12);
}

.preset-item[data-preset="workshop"].active {
    border-color: #047857;
    background: rgba(16, 185, 129, 0.12);
}

.preset-item[data-preset="caseStudy"].active {
    border-color: #d97706;
    background: rgba(245, 158, 11, 0.12);
}

.preset-item[data-preset="masterClass"].active {
    border-color: #dc2626;
    background: rgba(239, 68, 68, 0.12);
}
        
        .preset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .preset-title {
            font-weight: 700;
            color: #1f2937;
            font-size: 1.1rem;
        }
        
        .preset-hours {
            color: #7c3aed;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .preset-description {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 12px;
        }
        
        .preset-includes {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .preset-includes-title {
            font-weight: 600;
            color: #374151;
            font-size: 0.8rem;
            margin-bottom: 6px;
        }
        
        .preset-includes-list {
            color: #6b7280;
            font-size: 0.75rem;
            line-height: 1.3;
        }
        
        .preset-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .preset-quantity-label {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }
        
        .preset-quantity-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .component-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .component-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .component-item.selected {
            background: #ede9fe;
            border-color: #7c3aed;
        }
        
        .component-item.auto-selected {
            background: #ecfdf5;
            border-color: #10b981;
        }
        
        .component-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .component-header input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
        }
        
        .component-title {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        
        .component-hours {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .component-description {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.3;
            margin-left: 24px;
            margin-bottom: 10px;
        }
        
        .component-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 24px;
            margin-bottom: 8px;
            display: none;
        }
        
        .component-quantity.visible {
            display: flex;
        }
        
        .component-quantity-label {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .component-quantity-input {
            width: 80px;
            padding: 6px 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }
        
        .auto-selected-label {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 10px;
        }
        
        .service-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .service-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .service-item.selected {
            background: #ede9fe;
            border-color: #7c3aed;
        }
        
        .service-item.auto-selected {
            background: #ecfdf5;
            border-color: #10b981;
        }
        
        .service-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .service-header input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
        }
        
        .service-title {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        
        .service-hours {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .service-description {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.3;
            margin-left: 24px;
        }
        
        .quantity-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            margin-left: 24px;
            display: none;
        }
        
        .quantity-input-group.visible {
            display: flex;
        }
        
        .quantity-input-small {
            width: 80px;
            padding: 6px 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }
        
        .quantity-label-small {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .result-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    flex-shrink: 0;
}
        
        .result-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .result-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #4f46e5;
            margin-right: 10px;
            border-radius: 2px;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 800;
            color: #4f46e5;
            margin-bottom: 5px;
        }
        
        .result-subtitle {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.05rem;
            color: #1f2937;
        }
        
        .breakdown-left {
            flex: 1;
        }
        
        .breakdown-right {
            font-weight: 600;
            color: #4f46e5;
        }
        
        .breakdown-section {
            margin-bottom: 15px;
        }
        
        .breakdown-section-title {
            font-weight: 600;
            color: #4f46e5;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .result-section {
                border-left: none;
                border-top: 1px solid #e5e7eb;
                position: static;
                max-height: none;
            }
            
            .form-section, .result-section {
                padding: 20px;
            }
            
            .preset-grid {
                grid-template-columns: 1fr;
            }
            
            .components-grid {
                grid-template-columns: 1fr;
            }
        }

        .preset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

.preset-tag {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.7rem;
    font-weight: 500;
    margin-right: 4px;
    margin-bottom: 3px;
    border: 1px solid transparent;
}

.preset-tag.textLesson { 
    background: rgba(59, 130, 246, 0.15);
    color: #64748b;
    border-color: rgba(59, 130, 246, 0.25);
}

.preset-tag.videoLesson { 
    background: rgba(139, 92, 246, 0.15);
    color: #7c3aed;
    border-color: rgba(139, 92, 246, 0.25);
}

.preset-tag.webinar { 
    background: rgba(236, 72, 153, 0.15);
    color: #be185d;
    border-color: rgba(236, 72, 153, 0.25);
}

.preset-tag.workshop { 
    background: rgba(16, 185, 129, 0.15);
    color: #047857;
    border-color: rgba(16, 185, 129, 0.25);
}

.preset-tag.caseStudy { 
    background: rgba(245, 158, 11, 0.15);
    color: #d97706;
    border-color: rgba(245, 158, 11, 0.25);
}

.preset-tag.masterClass { 
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
    border-color: rgba(239, 68, 68, 0.25);
}

.copy-button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.copy-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
}

.copy-button:active {
    transform: translateY(0);
}

.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip-content {
    visibility: hidden;
    width: 200px;
    background-color: #1f2937;
    color: white;
    text-align: center;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.8rem;
    line-height: 1.3;
}

.financial-control-item .tooltip-content {
    bottom: 150%;
    width: 180px;
    margin-left: -90px;
}

.tooltip-content::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #1f2937 transparent transparent transparent;
}

.tooltip.show .tooltip-content {
    visibility: visible;
    opacity: 1;
}

.slider-group {
    margin-bottom: 20px;
}

.slider-value {
    margin-top: 8px;
    font-size: 0.9rem;
    color: #6b7280;
    font-weight: 500;
}
	    
.slider-container {
    position: relative;
}

	    /* Новые стили для финансовых настроек */
.financial-settings-card {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.financial-settings-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
}

.financial-settings-title::before {
    content: '💰';
    margin-right: 8px;
    font-size: 1.1rem;
}

.financial-settings-description {
    color: #6b7280;
    font-size: 0.9rem;
    margin-bottom: 20px;
    line-height: 1.4;
}

.financial-controls-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    align-items: start;
}

@media (max-width: 1024px) {
    .financial-controls-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
}

.financial-control-item {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.3s ease;
}

.financial-control-item:hover {
    border-color: #7c3aed;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.1);
}

.financial-control-label {
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.financial-control-description {
    font-size: 0.8rem;
    color: #6b7280;
    margin-bottom: 12px;
    line-height: 1.3;
}

.slider-wrapper {
    position: relative;
    margin-bottom: 8px;
}

.slider-wrapper input[type="range"] {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: #e5e7eb;
    outline: none;
    -webkit-appearance: none;
}

.slider-wrapper input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #7c3aed;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.slider-wrapper input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #7c3aed;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.financial-slider-value {
    font-size: 0.85rem;
    color: #7c3aed;
    font-weight: 600;
    text-align: center;
}

.checkbox-wrapper {
    display: flex;
    align-items: flex-start;
    gap: 8px;
}

.checkbox-wrapper input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin: 0;
    accent-color: #7c3aed;
}

.checkbox-wrapper label {
    font-size: 0.9rem;
    font-weight: 500;
    color: #374151;
    line-height: 1.3;
    margin: 0;
}

.pricing-method-card {
    background: linear-gradient(135deg, #fef7ff 0%, #f3e8ff 100%);
    border: 2px solid #d8b4fe;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
}

.pricing-method-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #7c2d12;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
}

.pricing-method-title::before {
    content: '⚙️';
    margin-right: 8px;
}

.pricing-method-description {
    color: #92400e;
    font-size: 0.9rem;
    margin-bottom: 15px;
    line-height: 1.4;
}

.method-options {
    display: flex;
    gap: 25px;
    margin-bottom: 15px;
}

.method-option {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-weight: 500;
    color: #7c2d12;
}

.method-option input[type="radio"] {
    width: 18px;
    height: 18px;
    accent-color: #7c3aed;
}

.detail-level-section {
    border-top: 1px solid #d8b4fe;
    padding-top: 15px;
    margin-top: 15px;
}

.detail-level-title {
    font-weight: 600;
    color: #7c2d12;
    margin-bottom: 10px;
}

.detail-options {
    display: flex;
    gap: 25px;
}

/* Стили для блоков настройки детализации */
.detail-settings-card {
    background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
    border: 2px solid #bbf7d0;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.detail-settings-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
}

.detail-settings-title::before {
    content: '🎛️';
    margin-right: 8px;
    font-size: 1.1rem;
}

.detail-settings-description {
    color: #6b7280;
    font-size: 0.9rem;
    margin-bottom: 20px;
    line-height: 1.4;
}

.detail-mode-block {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.detail-mode-block:hover {
    border-color: #10b981;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
}

.detail-mode-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.detail-mode-icon {
    font-size: 1.2rem;
    margin-right: 8px;
}

.detail-mode-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
}

.detail-mode-description {
    color: #6b7280;
    font-size: 0.85rem;
    line-height: 1.4;
    margin-bottom: 15px;
    padding-left: 30px;
}

/* Стили для блоков параметров ценообразования */
.pricing-params-card {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border: 2px solid #fbbf24;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.pricing-params-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
}

.pricing-params-title::before {
    content: '💳';
    margin-right: 8px;
    font-size: 1.1rem;
}

.pricing-params-description {
    color: #6b7280;
    font-size: 0.9rem;
    margin-bottom: 20px;
    line-height: 1.4;
}

.pricing-param-block {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.pricing-param-block:hover {
    border-color: #fbbf24;
    box-shadow: 0 2px 8px rgba(251, 191, 36, 0.1);
}

.pricing-param-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.pricing-param-icon {
    font-size: 1.2rem;
    margin-right: 8px;
}

.pricing-param-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
}

.pricing-param-description {
    color: #6b7280;
    font-size: 0.85rem;
    line-height: 1.4;
    margin-bottom: 15px;
    padding-left: 30px;
}

    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Калькулятор методических услуг 2.0</h1>
            <p>Гибкая система расчета с пресетами и детальной настройкой</p>
        </div>
        
        <div class="content">
            <div class="form-section">
                                
<!-- Блок системы ценообразования -->
<div class="pricing-method-card">
    <div class="pricing-method-title">Система ценообразования</div>
    <div class="pricing-method-description">
        Выберите метод расчета стоимости и уровень детализации для настройки коэффициентов сложности
    </div>
    
    <div>
        <div class="method-options">
            <label class="method-option">
                <input type="radio" name="pricingMethod" value="hourly" checked>
                <span>⏱️ Почасовой расчет</span>
            </label>
            <label class="method-option">
                <input type="radio" name="pricingMethod" value="fixed">
                <span>💰 Фиксированные цены</span>
            </label>
        </div>
    </div>
    
    <div class="detail-level-section">
        <div class="detail-level-title">Уровень детализации:</div>
        <div class="detail-options">
            <label class="method-option">
                <input type="radio" name="detailLevel" value="quick" checked>
                <span>🎯 Быстрая оценка</span>
            </label>
            <label class="method-option">
                <input type="radio" name="detailLevel" value="detailed">
                <span>⚙️ Детальный расчет</span>
            </label>
        </div>
    </div>
</div>

<!-- Блок финансовых настроек -->
<div class="financial-settings-card">
    <div class="financial-settings-title">Финансовые настройки</div>
    <div class="financial-settings-description">
        Настройте скидки, наценки, налоговые параметры и политику объемных скидок для точного расчета итоговой стоимости
    </div>
    
    <div class="financial-controls-grid">
        <div class="financial-control-item">
            <div class="financial-control-label">Скидка / Наценка</div>
            <div class="financial-control-description">
                Корректировка цены для постоянных клиентов или сложных проектов
            </div>
            <div class="slider-wrapper">
                <div class="tooltip" id="discountTooltip">
                    <input type="range" id="discountRate" min="-50" max="50" step="5" value="0">
                    <div class="tooltip-content" id="discountTooltipContent">
                        Без изменений
                    </div>
                </div>
            </div>
            <div class="financial-slider-value" id="discountRateValue">0% (без изменений)</div>
        </div>
        
        <div class="financial-control-item">
            <div class="financial-control-label">Налоговая ставка</div>
            <div class="financial-control-description">
                Ставка налога в зависимости от статуса: самозанятый, ИП, ООО
            </div>
          <div class="slider-wrapper">
                <div class="tooltip" id="taxTooltip">
                    <input type="range" id="taxRate" min="0" max="30" step="1" value="13">
                    <div class="tooltip-content" id="taxTooltipContent">
                        НДФЛ для физлиц
                    </div>
                </div>
            </div>
            <div class="financial-slider-value" id="taxRateValue">13% (НДФЛ)</div>
        </div>
        
        <div class="financial-control-item">
            <div class="financial-control-label">Объемные скидки</div>
            <div class="financial-control-description">
                Автоматические скидки при заказе большого количества элементов
            </div>
            <div class="checkbox-wrapper">
                <input type="checkbox" id="enableVolumeDiscounts" checked>
                <label for="enableVolumeDiscounts">Применять скидки за объем<br><small>(6-15шт: -10%, 16-30шт: -20%, 31+шт: -30%)</small></label>
            </div>
            <div style="margin-top: 12px;">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="showTaxSeparately" checked>
                    <label for="showTaxSeparately">Показывать налог отдельной строкой</label>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Блоки параметров ценообразования -->
<div class="pricing-params-card">
    <div class="pricing-params-title">Параметры ценообразования</div>
    <div class="pricing-params-description">
        Настройте базовые параметры расчета стоимости в зависимости от выбранного метода
    </div>
    
    <!-- Блок для почасовой ставки -->
    <div id="hourlyRateBlock" class="pricing-param-block">
        <div class="pricing-param-header">
            <span class="pricing-param-icon">💳</span>
            <span class="pricing-param-title">Базовая ставка за час</span>
        </div>
        <div class="pricing-param-description">
            Используется для всех расчетов. Учитывайте ваш опыт, сложность работ и рыночные ставки
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <input type="number" id="hourlyRate" value="220" min="100" max="5000" style="width: 120px; padding: 8px; border: 2px solid #f59e0b; border-radius: 6px; text-align: center; font-weight: 600; color: #92400e;">
            <span style="color: #92400e; font-weight: 600;">₽/час</span>
        </div>
    </div>

    <!-- Блок для фиксированных цен -->
    <div id="fixedPricesBlock" class="pricing-param-block" style="display: none;">
        <div class="pricing-param-header">
            <span class="pricing-param-icon">💰</span>
            <span class="pricing-param-title">Фиксированные цены за единицу</span>
        </div>
        <div class="pricing-param-description">
            Установите цены для каждого типа контента. Цены автоматически корректируются по длительности
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 15px;">
            
            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 8px;">Текстовый урок</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" id="fixedPrice_textLesson" value="1200" min="100" max="10000" style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <span style="color: #6b7280;">₽/шт</span>
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">Базово: 30 мин</div>
            </div>
            
            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 8px;">Видео урок</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" id="fixedPrice_videoLesson" value="1800" min="100" max="10000" style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <span style="color: #6b7280;">₽/шт</span>
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">Базово: 60 мин</div>
            </div>
            
            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 8px;">Вебинар</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" id="fixedPrice_webinar" value="1500" min="100" max="10000" style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <span style="color: #6b7280;">₽/шт</span>
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">Базово: 90 мин</div>
            </div>
            
            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 8px;">Практикум</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" id="fixedPrice_workshop" value="2000" min="100" max="10000" style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <span style="color: #6b7280;">₽/шт</span>
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">Базово: 60 мин</div>
            </div>
            
            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 8px;">Кейс-стади</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" id="fixedPrice_caseStudy" value="1100" min="100" max="10000" style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <span style="color: #6b7280;">₽/шт</span>
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">Базово: 45 мин</div>
            </div>
            
            <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                <div style="font-weight: 600; color: #1f2937; margin-bottom: 8px;">Мастер-класс</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="number" id="fixedPrice_masterClass" value="1540" min="100" max="10000" style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <span style="color: #6b7280;">₽/шт</span>
                </div>
                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">Базово: 60 мин</div>
            </div>
            
        </div>
        
        <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 15px; margin-top: 15px;">
            <h4 style="color: #0369a1; margin-bottom: 8px; font-size: 1rem;">💡 Как работают фиксированные цены</h4>
            <p style="color: #0369a1; font-size: 0.9rem; line-height: 1.4; margin: 0;">
                Цены автоматически корректируются по длительности урока относительно базового времени. При детальном расчете дополнительно применяются ограниченные коэффициенты сложности.
            </p>
        </div>
    </div>
</div>
		    
<!-- Блоки настройки детализации -->
<div class="detail-settings-card">
    <div class="detail-settings-title">Настройки детализации</div>
    <div class="detail-settings-description">
        Выберите уровень детализации расчета и настройте параметры сложности проекта
    </div>
    
    <!-- Блок быстрой оценки -->
    <div id="quickComplexityGroup" class="detail-mode-block">
        <div class="detail-mode-header">
            <span class="detail-mode-icon">🎯</span>
            <span class="detail-mode-title">Быстрая оценка</span>
        </div>
        <div class="detail-mode-description">
            Получите приблизительную стоимость за 30 секунд. Все факторы сложности объединены в один селектор.
        </div>
        <div class="form-group">
            <label for="projectComplexity">Сложность проекта:</label>
            <select id="projectComplexity">
                <option value="1.0">Простой (знакомый домен + своя методика)</option>
                <option value="1.3" selected>Средний (один усложняющий фактор)</option>
                <option value="1.6">Сложный (несколько усложняющих факторов)</option>
                <option value="1.8">Экстремальный (все факторы + срочность)</option>
            </select>
            <div class="complexity-hint" id="complexityHint">
                Средняя сложность: новый домен ИЛИ чужая методика ИЛИ сложный контент
            </div>
        </div>
    </div>

    <!-- Блок детальной оценки -->
    <div id="detailedComplexityGroup" class="detail-mode-block" style="display: none;">
        <div class="detail-mode-header">
            <span class="detail-mode-icon">⚙️</span>
            <span class="detail-mode-title">Детальный расчет</span>
        </div>
        <div class="detail-mode-description">
            Максимально точная оценка с учетом всех факторов сложности по отдельности. Рекомендуется для крупных проектов.
        </div>
        
        <div class="form-group">
            <label for="methodistRole">Роль методиста:</label>
            <select id="methodistRole">
                <option value="1.0">Методист-автор (пишу контент сам)</option>
                <option value="0.5">Методист-редактор (проверяю за автором)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="domainKnowledge">Знание предметной области:</label>
            <select id="domainKnowledge">
                <option value="1.0">Знаю домен хорошо</option>
                <option value="1.3">Новый домен (требуется изучение)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="projectType">Характер работы:</label>
            <select id="projectType">
                <option value="1.0">Новая программа по моей методике</option>
                <option value="1.2">Доработка существующих материалов</option>
                <option value="1.4">Работа по чужой программе/методике</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="contentComplexity">Сложность контента:</label>
            <select id="contentComplexity">
                <option value="1.0">Простой - теория и понятия</option>
                <option value="1.2" selected>Средний - теория + применение</option>
                <option value="1.4">Сложный - теория + применение + инструменты</option>
                <option value="1.6">Высокосложный - теория + применение + инструменты + кейсы</option>
            </select>
        </div>

        <div class="form-group">
            <label for="urgency">Срочность выполнения:</label>
            <select id="urgency">
                <option value="1.0">Обычная (без ограничений по времени)</option>
                <option value="1.2">Ускоренная (сжатые сроки) - +20%</option>
                <option value="1.5">Срочная (очень сжатые сроки) - +50%</option>
                <option value="2.0">Экстренная (критические сроки) - +100%</option>
            </select>
        </div>

        <div class="form-group">
            <label for="qualityLevel">Уровень качества:</label>
            <select id="qualityLevel">
                <option value="0.7">Базовый (экономия 30%)</option>
                <option value="1.0" selected>Стандарт</option>
                <option value="1.5">Премиум (+50%)</option>
            </select>
        </div>
    </div>
</div>
		    
<div class="info-card" id="calculationInfo" style="background: #f0f9ff; border-color: #0ea5e9;">
    <h4> Настройки расчета</h4>
    <p id="calculationDescription">
        <strong>Коэффициенты сложности:</strong> Включены<br>
        <strong>Скидки за объем:</strong> Включены (6-15шт: -10%, 16-30шт: -20%, 31+шт: -30%)
    </p>
</div>

<div class="info-card" id="modeInfo" style="background: #ecfdf5; border-color: #10b981; display: none;">
    <h4>🎯 Быстрая оценка</h4>
    <p>Получите приблизительную стоимость за 30 секунд. Все факторы сложности объединены в один селектор. Идеально для первичных переговоров с клиентами.</p>
</div>
               
                <div class="section-title">Быстрые пресеты (по типам контента)</div>
                
                <div class="info-card">
    <h4>Как работают пресеты</h4>
    <p>Пресеты - это готовые пакеты услуг с фиксированным составом. Цена зависит от количества и длительности. Дополнительно система может предложить связанные услуги (помечены "АВТО").</p>
</div>

<div class="preset-grid">
                    <div class="preset-item" data-preset="textLesson">
                        <div class="preset-header">
                            <div class="preset-title">Текстовый урок</div>
                            <div class="preset-hours" id="textLessonPrice">1 210 ₽/шт</div>
                        </div>
                        <div class="preset-description">Статья для самостоятельного изучения теории и концепций (20-40 мин чтения)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Базово включает:</div>
<div class="preset-includes-list">Лонгрид + Упражнения + Иллюстрации + Квизы</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="textLessonPreset" value="0" min="0" max="50">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="textLessonDuration" value="30" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="videoLesson">
                        <div class="preset-header">
                            <div class="preset-title">Видео урок</div>
                            <div class="preset-hours" id="videoLessonPrice">1 760 ₽/шт</div>
                        </div>
                        <div class="preset-description">Видеоурок с презентацией для объяснения процессов и демонстрации (30-90 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Базово включает:</div>
<div class="preset-includes-list">Скрипт + Презентация + Иллюстрации</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="videoLessonPreset" value="0" min="0" max="50">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="videoLessonDuration" value="60" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="webinar">
                        <div class="preset-header">
                            <div class="preset-title">Вебинар</div>
                            <div class="preset-hours" id="webinarPrice">1 540 ₽/шт</div>
                        </div>
                        <div class="preset-description">Живое онлайн-обучение с интерактивным взаимодействием с аудиторией (60-120 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Базово включает:</div>
<div class="preset-includes-list">Презентация + Иллюстрации + Механики вовлечения</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="webinarPreset" value="0" min="0" max="20">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="webinarDuration" value="90" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="workshop">
                        <div class="preset-header">
                            <div class="preset-title">Практикум</div>
                            <div class="preset-hours" id="workshopPrice">1 980 ₽/шт</div>
                        </div>
                        <div class="preset-description">Воркшоп для отработки навыков с пошаговыми инструкциями (60-180 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Базово включает:</div>
<div class="preset-includes-list">Инструкции + Шаблоны + Упражнения + Примеры</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="workshopPreset" value="0" min="0" max="20">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="workshopDuration" value="60" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="caseStudy">
                        <div class="preset-header">
                            <div class="preset-title">Кейс-стади</div>
                          <div class="preset-hours" id="caseStudyPrice">1 100 ₽/шт</div>
                        </div>
                        <div class="preset-description">Разбор реальной ситуации для анализа и обсуждения решений (30-60 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Базово включает:</div>
<div class="preset-includes-list">Описание кейса + Вопросы + Разбор решения</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="caseStudyPreset" value="0" min="0" max="20">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="caseStudyDuration" value="45" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="masterClass">
                        <div class="preset-header">
                            <span class="preset-title">Мастер-класс</span>
                            <div class="preset-hours" id="masterClassPrice">1 540 ₽/шт</div>
                        </div>
                        <div class="preset-description">Демонстрация экспертного подхода на конкретном примере (45-90 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Базово включает:</div>
<div class="preset-includes-list">Разбор кейса + Вопросы для анализа + Разбор решения</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="masterClassPreset" value="0" min="0" max="50">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="masterClassDuration" value="60" min="10" max="240">
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Дополнительные компоненты</div>
                
    <div class="info-card">
    <h4>Дополнительные компоненты</h4>
    <p>Полностью независимые от пресетов компоненты. Можно добавлять любые, даже если такие же есть в пресетах.<br>
    <span style="color: #7c3aed;">●</span> Каждый компонент настраивается независимо</p>
</div>
              
              <div class="components-grid">
                    <div class="component-item" data-component="longread">
                        <div class="component-header">
                            <input type="checkbox" id="longread">
                            <span class="component-title">Лонгрид</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="longreadHoursDisplay">2.5ч/шт</span>
    <span class="component-price" id="longreadPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">550 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Структурированная статья урока объемом 1500-2000 знаков для самостоятельного изучения</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                        </div>
                        <div class="component-quantity" id="longreadQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="longreadHours" value="2.5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="longreadCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="longreadCount" value="1" min="1" max="50">
                        </div>
                        <div class="component-quantity" id="longreadPagesGroup">
                            <span class="component-quantity-label">Листы А4:</span>
                            <input type="number" class="component-quantity-input" id="longreadPages" value="1" min="0.5" max="10" step="0.5">
                        </div>
                    </div>

                    <div class="component-item" data-component="script">
                        <div class="component-header">
                            <input type="checkbox" id="script">
                            <span class="component-title">Скрипт для записи</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="scriptHoursDisplay">4ч/шт</span>
    <span class="component-price" id="scriptPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">880 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Готовый текст с разметкой и комментариями для записи видеоурока длительностью 30-90 минут</div>
                        <div class="preset-tags">
                            <span class="preset-tag videoLesson">Видео уроки</span>
                        </div>
                        <div class="component-quantity" id="scriptQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="scriptHours" value="4" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="scriptCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="scriptCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="presentation">
                        <div class="component-header">
                            <input type="checkbox" id="presentation">
                            <span class="component-title">Презентация</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="presentationHoursDisplay">6ч/шт</span>
    <span class="component-price" id="presentationPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">1 320 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Слайд-дека из 15-25 слайдов с текстом и структурой для урока или вебинара</div>
                        <div class="preset-tags">
                            <span class="preset-tag videoLesson">Видео уроки</span>
                            <span class="preset-tag webinar">Вебинары</span>
                        </div>
                        <div class="component-quantity" id="presentationQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="presentationHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="presentationCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="presentationCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="exercises">
                        <div class="component-header">
                            <input type="checkbox" id="exercises">
                            <span class="component-title">Упражнения</span>
                           <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="exercisesHoursDisplay">1ч/шт</span>
    <span class="component-price" id="exercisesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">220 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Практические задания на отработку навыков внутри урока с инструкциями и примерами</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="exercisesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="exercisesHours" value="1" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="exercisesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="exercisesCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="illustrations">
                        <div class="component-header">
                            <input type="checkbox" id="illustrations">
                            <span class="component-title">Иллюстрации</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="illustrationsHoursDisplay">0.5ч/шт</span>
    <span class="component-price" id="illustrationsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">110 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Подбор и адаптация 5-10 визуальных материалов для поддержки контента урока</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                            <span class="preset-tag videoLesson">Видео уроки</span>
                            <span class="preset-tag webinar">Вебинары</span>
                        </div>
                        <div class="component-quantity" id="illustrationsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="illustrationsHours" value="0.5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="illustrationsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="illustrationsCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="quizzes">
                        <div class="component-header">
                            <input type="checkbox" id="quizzes">
                            <span class="component-title">Квизы</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="quizzesHoursDisplay">1.5ч/шт</span>
    <span class="component-price" id="quizzesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">330 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Интерактивная проверка из 5-10 вопросов для закрепления материала урока</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                        </div>
                        <div class="component-quantity" id="quizzesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="quizzesHours" value="1.5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="quizzesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="quizzesCount" value="1" min="1" max="50">
                        </div>
                        <div class="component-quantity" id="quizzesQuestionsGroup">
                            <span class="component-quantity-label">Вопросов:</span>
                            <input type="number" class="component-quantity-input" id="quizzesQuestions" value="7" min="1" max="20">
                        </div>
                    </div>
                
                	<div class="component-item" data-component="instructions">
                        <div class="component-header">
                            <input type="checkbox" id="instructions">
                            <span class="component-title">Пошаговые инструкции</span>
                           <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="instructionsHoursDisplay">3ч/шт</span>
    <span class="component-price" id="instructionsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">660 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Детальный алгоритм действий с пошаговым разбором для самостоятельного выполнения</div>
                        <div class="preset-tags">
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="instructionsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="instructionsHours" value="3" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="instructionsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="instructionsCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="templates">
                        <div class="component-header">
                            <input type="checkbox" id="templates">
                            <span class="component-title">Шаблоны/Канвасы</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="templatesHoursDisplay">2ч/шт</span>
    <span class="component-price" id="templatesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">440 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Готовые бланки и формы для заполнения участниками во время практических занятий</div>
                        <div class="preset-tags">
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="templatesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="templatesHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="templatesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="templatesCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="examples">
                        <div class="component-header">
                            <input type="checkbox" id="examples">
                            <span class="component-title">Разбор примера</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="examplesHoursDisplay">2ч/шт</span>
    <span class="component-price" id="examplesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">440 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Детальный анализ реального или учебного кейса с объяснением решений и выводов</div>
                        <div class="preset-tags">
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="examplesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="examplesHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="examplesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="examplesCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="caseDescription">
                        <div class="component-header">
                            <input type="checkbox" id="caseDescription">
                            <span class="component-title">Разбор кейса</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="caseDescriptionHoursDisplay">3ч/шт</span>
    <span class="component-price" id="caseDescriptionPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">660 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Структурированное описание ситуации с контекстом и данными для анализа участниками</div>
                        <div class="preset-tags">
                            <span class="preset-tag caseStudy">Кейс-стади</span>
                            <span class="preset-tag masterClass">Мастер-классы</span>
                        </div>
                        <div class="component-quantity" id="caseDescriptionQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="caseDescriptionHours" value="3" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="caseDescriptionCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="caseDescriptionCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="caseQuestions">
                        <div class="component-header">
                            <input type="checkbox" id="caseQuestions">
                            <span class="component-title">Вопросы для анализа</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="caseQuestionsHoursDisplay">1ч/шт</span>
    <span class="component-price" id="caseQuestionsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">220 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Набор из 5-8 направляющих вопросов для самостоятельного разбора кейса участниками</div>
                        <div class="preset-tags">
                            <span class="preset-tag caseStudy">Кейс-стади</span>
                            <span class="preset-tag masterClass">Мастер-классы</span>
                        </div>
                        <div class="component-quantity" id="caseQuestionsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="caseQuestionsHours" value="1" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="caseQuestionsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="caseQuestionsCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="caseSolution">
                        <div class="component-header">
                            <input type="checkbox" id="caseSolution">
                            <span class="component-title">Разбор решения</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="caseSolutionHoursDisplay">1ч/шт</span>
    <span class="component-price" id="caseSolutionPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">220 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Экспертный комментарий с объяснением правильного решения кейса и альтернативных вариантов</div>
                        <div class="preset-tags">
                            <span class="preset-tag caseStudy">Кейс-стади</span>
                            <span class="preset-tag masterClass">Мастер-классы</span>
                        </div>
                        <div class="component-quantity" id="caseSolutionQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="caseSolutionHours" value="1" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="caseSolutionCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="caseSolutionCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="engagementMechanics">
                        <div class="component-header">
                            <input type="checkbox" id="engagementMechanics">
                            <span class="component-title">Механики вовлечения</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="engagementMechanicsHoursDisplay">2ч/шт</span>
    <span class="component-price" id="engagementMechanicsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">440 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Интерактивные элементы для удержания внимания: опросы, чаты, голосования, мини-игры</div>
                        <div class="preset-tags">
                            <span class="preset-tag webinar">Вебинары</span>
                        </div>
                        <div class="component-quantity" id="engagementMechanicsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="engagementMechanicsHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="engagementMechanicsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="engagementMechanicsCount" value="1" min="1" max="50">
                        </div>
                    </div>
                </div>

				<div class="section-title">Система проверки знаний</div>
                
                <div class="service-grid">
                    <div class="service-item" data-service="currentTests">
                        <div class="service-header">
                            <input type="checkbox" id="currentTests">
                            <span class="service-title">Текущая проверка</span>
                            <span class="service-hours" id="currentTestsHoursDisplay">2ч/шт</span>
                        </div>
                        <div class="service-description">Тесты и домашние задания на 10-15 вопросов для закрепления материала каждого урока</div>
                        <div class="quantity-input-group" id="currentTestsHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="currentTestsHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="quantity-input-group" id="currentTestsCountGroup">
                            <span class="quantity-label-small">Количество:</span>
                            <input type="number" class="quantity-input-small" id="currentTestsCount" value="1" min="1" max="30">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="moduleProjects">
                        <div class="service-header">
                            <input type="checkbox" id="moduleProjects">
                            <span class="service-title">Промежуточная проверка</span>
                            <span class="service-hours" id="moduleProjectsHoursDisplay">4ч/шт</span>
                        </div>
                        <div class="service-description">Практические проекты и кейсы для проверки навыков в конце модуля или блока уроков</div>
                        <div class="quantity-input-group" id="moduleProjectsHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="moduleProjectsHours" value="4" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="quantity-input-group" id="moduleProjectsCountGroup">
                            <span class="quantity-label-small">Количество:</span>
                            <input type="number" class="quantity-input-small" id="moduleProjectsCount" value="1" min="1" max="10">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="finalAssessment">
                        <div class="service-header">
                            <input type="checkbox" id="finalAssessment">
                            <span class="service-title">Итоговая проверка</span>
                            <span class="service-hours" id="finalAssessmentHoursDisplay">6ч/шт</span>
                        </div>
                        <div class="service-description">Комплексная аттестация знаний и навыков в конце программы обучения с оценкой результатов</div>
                        <div class="quantity-input-group" id="finalAssessmentHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="finalAssessmentHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="quantity-input-group" id="finalAssessmentCountGroup">
                            <span class="quantity-label-small">Количество:</span>
                            <input type="number" class="quantity-input-small" id="finalAssessmentCount" value="1" min="1" max="5">
                        </div>
                    </div>
                </div>
                
<div class="section-title">Кастомные услуги</div>

<div class="info-card">
    <h4>Создайте свои услуги</h4>
    <p>Добавьте любые дополнительные работы, которых нет в стандартном списке</p>
</div>

<div id="customServicesContainer">
    <div class="custom-service-form" id="customServiceForm">
        <div style="background: #f9fafb; border: 2px dashed #d1d5db; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151; font-size: 0.9rem;">Название услуги:</label>
                    <input type="text" id="customServiceName" placeholder="Например: Дизайн логотипа" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151; font-size: 0.9rem;">Описание (опционально):</label>
                    <input type="text" id="customServiceDescription" placeholder="Краткое описание" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151; font-size: 0.9rem;">Время (ч):</label>
                    <input type="number" id="customServiceHours" value="1" min="0.1" max="100" step="0.1" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: center;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151; font-size: 0.9rem;">Количество:</label>
                    <input type="number" id="customServiceCount" value="1" min="1" max="100" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: center;">
                </div>
               <div>
    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151; font-size: 0.9rem;">Цена за ед. (₽):</label>
    <input type="number" id="customServicePrice" value="220" min="1" max="100000" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 600; color: #7c3aed;">
</div>
                <div>
                    <button onclick="addCustomService()" style="padding: 8px 16px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 14px;">+ Добавить</button>
                </div>
            </div>
        </div>
    </div>
    <div id="customServicesList"></div>
</div>

                <div class="section-title">Дополнительные услуги</div>
                
                <div class="service-grid">
                    <div class="service-item" data-service="research">
                        <div class="service-header">
                            <input type="checkbox" id="research">
                            <span class="service-title">Кабинетное исследование</span>
                            <span class="service-hours" id="researchHoursDisplay">6ч</span>
                        </div>
                       <div class="service-description">Изучение предметной области, анализ конкурентов и лучших практик для создания актуального контента</div>
                        <div class="quantity-input-group" id="researchHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="researchHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="audit">
                        <div class="service-header">
                            <input type="checkbox" id="audit">
                            <span class="service-title">Методический аудит</span>
                            <span class="service-hours" id="auditHoursDisplay">6ч</span>
                        </div>
                        <div class="service-description">Экспертная оценка существующих материалов с рекомендациями по улучшению структуры и качества</div>
                        <div class="quantity-input-group" id="auditHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="auditHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="methodology">
                        <div class="service-header">
                            <input type="checkbox" id="methodology">
                            <span class="service-title">Методические артефакты</span>
                            <span class="service-hours" id="methodologyHoursDisplay">5ч</span>
                        </div>
                        <div class="service-description">Карта образовательных результатов и детальный тематический план программы обучения</div>
                        <div class="quantity-input-group" id="methodologyHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="methodologyHours" value="5" min="0.1" max="20" step="0.1">
                        </div>
                    </div>

                    <div class="service-item" data-service="speakerPrep">
                        <div class="service-header">
                            <input type="checkbox" id="speakerPrep">
                            <span class="service-title">Подготовка спикера к записи урока</span>
                            <span class="service-hours" id="speakerPrepHoursDisplay">4ч</span>
                        </div>
                        <div class="service-description">Тренировка подачи материала, работа с речью и подготовка к качественной записи контента</div>
                        <div class="quantity-input-group" id="speakerPrepHoursGroup">
                            <span class="quantity-label-small">Общее время на подготовку (ч):</span>
                            <input type="number" class="quantity-input-small" id="speakerPrepHours" value="4" min="0.1" max="20" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Правки и итерации</div>
                
                <div class="form-group">
                    <label for="clientType">Тип заказчика:</label>
                    <select id="clientType">
                        <option value="10">Постоянный заказчик (знаю стиль) - 10%</option>
                        <option value="20" selected>Новый заказчик (притирка) - 20%</option>
                        <option value="0">Без правок - 0%</option>
                    </select>
                </div>
                
                <div class="info-card">
                    <h4>Важно: правки касаются только контента</h4>
                    <p>Правки применяются к компонентам образовательного контента и проверкам знаний. Дополнительные услуги не подлежат правкам.</p>
                </div>
          
                </div>
            
<div class="result-section">
                <div class="result-card">
                    <div class="result-title">Итоговая стоимость</div>
                    <div class="result-value" id="totalCost">0 ₽</div>
                    <div class="result-subtitle">За весь проект</div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Общее время</div>
                    <div class="result-value" id="totalHours">0 ч</div>
                    <div class="result-subtitle">Трудозатраты</div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Состав проекта</div>
                    <div id="projectComposition">
                        <div style="color: #6b7280; font-style: italic;">Выберите компоненты или используйте пресеты</div>
                    </div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Детализация</div>
                    <div id="breakdown">
                        <div style="color: #6b7280; font-style: italic;">Расчет появится после выбора компонентов</div>
                    </div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Для клиента</div>
                    <button class="copy-button" onclick="copyCalculationToClipboard()">
                        Копировать расчет
                    </button>
                    <div class="copy-status" id="copyStatus" style="margin-top: 10px; color: #10b981; font-size: 0.9rem; display: none;">
                        ✓ Скопировано в буфер обмена
                    </div>
                </div>
            </div>
        </div>

	<script>

// Функция обновления подсказок для сложности проекта
function updateComplexityHint() {
    const complexity = safeGetValue('projectComplexity', 1.3);
    const hintElement = safeGetElement('complexityHint');
    
    if (!hintElement) return;
    
    const hints = {
        1.0: 'Простой проект: знакомый домен + своя методика + простой контент',
        1.3: 'Средняя сложность: новый домен ИЛИ чужая методика ИЛИ сложный контент',
        1.6: 'Сложный проект: два усложняющих фактора одновременно',
        1.8: 'Экстремальный проект: все факторы сложности + срочность'
    };
    
    hintElement.textContent = hints[complexity] || hints[1.3];
}

// Конфигурация фиксированных цен
const fixedPrices = {
    textLesson: { default: 1200, current: 1200, baseDuration: 30 },
    videoLesson: { default: 1800, current: 1800, baseDuration: 60 },
    webinar: { default: 1500, current: 1500, baseDuration: 90 },
    workshop: { default: 2000, current: 2000, baseDuration: 60 },
    caseStudy: { default: 1100, current: 1100, baseDuration: 45 },
    masterClass: { default: 1540, current: 1540, baseDuration: 60 }
};

// Функции для получения значений радиокнопок
function safeGetRadioValue(name, defaultValue) {
    const checkedRadio = document.querySelector(`input[name="${name}"]:checked`);
    return checkedRadio ? checkedRadio.value : defaultValue;
}

// Функция управления видимостью блоков
function updateInterfaceVisibility() {
    const pricingMethod = safeGetRadioValue('pricingMethod', 'hourly');
    const detailLevel = safeGetRadioValue('detailLevel', 'quick');
    
    // Показываем/скрываем блоки ценообразования
    const hourlyBlock = safeGetElement('hourlyRateBlock');
    const fixedBlock = safeGetElement('fixedPricesBlock');
    
    if (hourlyBlock) {
        hourlyBlock.style.display = pricingMethod === 'hourly' ? 'block' : 'none';
    }
    if (fixedBlock) {
        fixedBlock.style.display = pricingMethod === 'fixed' ? 'block' : 'none';
    }
    
    // Показываем/скрываем блоки детализации
    const quickBlock = safeGetElement('quickComplexityGroup');
    const detailedBlock = safeGetElement('detailedComplexityGroup');
    
    if (quickBlock) {
        quickBlock.style.display = detailLevel === 'quick' ? 'block' : 'none';
    }
    if (detailedBlock) {
        detailedBlock.style.display = detailLevel === 'detailed' ? 'block' : 'none';
    }
    
    // Обновляем информационную панель
    updateCalculationInfo();
    
    // Пересчитываем стоимость
    calculateCost();
}

 // Конфигурация пресетов
    const presets = {
        textLesson: {
            name: 'Текстовые уроки',
            components: ['longread', 'exercises', 'illustrations', 'quizzes'],
            baseHours: 5.5,
            defaultDuration: 30
        },
        videoLesson: {
            name: 'Видео уроки',
            components: ['script', 'presentation', 'illustrations'],
            baseHours: 8,
            defaultDuration: 60
        },
        webinar: {
            name: 'Вебинары',
            components: ['presentation', 'illustrations', 'engagementMechanics'],
            baseHours: 7,
            defaultDuration: 90
        },
        workshop: {
            name: 'Практикумы',
            components: ['instructions', 'templates', 'exercises', 'examples'],
            baseHours: 9,
            defaultDuration: 60
        },
        caseStudy: {
            name: 'Кейс-стади',
            components: ['caseDescription', 'caseQuestions', 'caseSolution'],
            baseHours: 5,
            defaultDuration: 45
        },
        masterClass: {
            name: 'Мастер-классы',
            components: ['caseDescription', 'caseQuestions', 'caseSolution'],
            baseHours: 7,
            defaultDuration: 60
        }
    };

    // Конфигурация компонентов
    const components = {
        longread: { 
            defaultHours: 2.5, 
            name: 'Лонгрид', 
            description: 'Структурированный текстовый материал урока из расчета 1 лист А4 машинописного текста', 
            presets: ['textLesson'] 
        },
        script: { 
            defaultHours: 4, 
            name: 'Скрипт для записи', 
            description: 'Текст для самостоятельной видеозаписи урока с разметкой комментариев', 
            presets: ['videoLesson'] 
        },
        presentation: { 
            defaultHours: 6, 
            name: 'Презентация', 
            description: 'Слайды для урока или вебинара без учета подбора иллюстраций', 
            presets: ['videoLesson', 'webinar'] 
        },
        exercises: { 
            defaultHours: 1, 
            name: 'Упражнения', 
            description: 'Практические задания внутри урока', 
            presets: ['textLesson', 'workshop'] 
        },
        illustrations: { 
            defaultHours: 0.5, 
            name: 'Иллюстрации', 
            description: 'Поиск и упаковка визуальных материалов для уроков', 
            presets: ['textLesson', 'videoLesson', 'webinar'] 
        },
        quizzes: { 
            defaultHours: 1.5, 
            name: 'Квизы', 
            description: 'Интерактивные элементы для повышения вовлеченности', 
            presets: ['textLesson'] 
        },
        instructions: { 
            defaultHours: 3, 
            name: 'Пошаговые инструкции', 
            description: 'Детальные руководства к действию/применению для отдельного изучения', 
            presets: ['workshop'] 
        },
        templates: {
            defaultHours: 2, 
            name: 'Шаблоны/Канвасы', 
            description: 'Подбор, адаптация или разработка новых форм для заполнения', 
            presets: ['workshop'] 
        },
        examples: { 
            defaultHours: 2, 
            name: 'Разбор примера', 
            description: 'Разработка и описание детального анализа практических и гипотетических случаев', 
            presets: ['workshop'] 
        },
        caseDescription: { 
            defaultHours: 3, 
            name: 'Разбор кейса', 
            description: 'Разработка и описание структурированно изложенной ситуации', 
            presets: ['caseStudy', 'masterClass'] 
        },
        caseQuestions: { 
            defaultHours: 1, 
            name: 'Вопросы для анализа', 
            description: 'Формирование пакета вопросов для готового кейса', 
            presets: ['caseStudy', 'masterClass'] 
        },
        caseSolution: { 
            defaultHours: 1, 
            name: 'Разбор решения', 
            description: 'Упаковка экспертного комментария или решения кейса в обучающий формат', 
            presets: ['caseStudy', 'masterClass'] 
        },
        engagementMechanics: { 
            defaultHours: 2, 
            name: 'Механики вовлечения', 
            description: 'Подбор, адаптация и разработка интерактивных элементов для удержания внимания', 
            presets: ['webinar'] 
        }
    };

    // Конфигурация проверок знаний
    const assessments = {
        currentTests: { defaultHours: 2, name: 'Текущая проверка' },
        moduleProjects: { defaultHours: 4, name: 'Промежуточная проверка' },
        finalAssessment: { defaultHours: 6, name: 'Итоговая проверка' }
    };

    // Конфигурация дополнительных услуг
    const services = {
        research: { defaultHours: 6, name: 'Кабинетное исследование' },
        audit: { defaultHours: 6, name: 'Методический аудит' },
        methodology: { defaultHours: 5, name: 'Методические артефакты' },
        speakerPrep: { defaultHours: 4, name: 'Подготовка спикера к записи урока' }
    };

// Система весов для коэффициентов
const influenceWeights = {
    domain: 0.6,        // Изучение нового домена
    project: 0.8,       // Тип проекта/методики
    complexity: 1.0,    // Сложность контента (базовая)
    urgency: 0.5        // Срочность выполнения
};

// Нормализация весов
const totalInfluence = Object.values(influenceWeights).reduce((sum, weight) => sum + weight, 0);
const normalizedWeights = {};
Object.keys(influenceWeights).forEach(key => {
    normalizedWeights[key] = influenceWeights[key] / totalInfluence;
});


// Функция обновления цен в пресетах
function updatePresetPrices() {
    const pricingMethod = safeGetRadioValue('pricingMethod', 'hourly');
    const hourlyRate = safeGetValue('hourlyRate', 220);
    const detailLevel = safeGetRadioValue('detailLevel', 'quick');
    const methodistRole = safeGetValue('methodistRole', 1.0);
    const domainKnowledge = safeGetValue('domainKnowledge', 1.0);
    const projectType = safeGetValue('projectType', 1.0);
    const contentComplexity = safeGetValue('contentComplexity', 1.2);
    const urgency = safeGetValue('urgency', 1.0);
    const qualityLevel = safeGetValue('qualityLevel', 1.0);
    
    Object.keys(presets).forEach(presetType => {
        const count = parseInt(safeGetValue(presetType + 'Preset', 0));
        const presetDuration = parseInt(safeGetValue(presetType + 'Duration', presets[presetType].defaultDuration));
        
        let pricePerUnit;
        
        if (pricingMethod === 'fixed') {
            // Расчет по фиксированным ценам (только длительность + объем)
            const basePrice = fixedPrices[presetType].current;
            const durationFactor = presetDuration / fixedPrices[presetType].baseDuration;
            const volumeDiscount = getVolumeDiscount(count);
            
            pricePerUnit = Math.round(basePrice * durationFactor * volumeDiscount);
        } else {
            // Почасовой расчет
            const durationFactor = presetDuration / presets[presetType].defaultDuration;
            let baseHours = 0;
            
            presets[presetType].components.forEach(componentId => {
                const hours = safeGetValue(componentId + 'Hours', components[componentId]?.defaultHours || 1);
                baseHours += hours;
            });
            
            const complexityMultiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
            const volumeDiscount = getVolumeDiscount(count);
            const adjustedHours = baseHours * durationFactor * complexityMultiplier * qualityLevel * volumeDiscount;
            pricePerUnit = Math.round(adjustedHours * hourlyRate);
        }
        
        const priceElement = safeGetElement(presetType + 'Price');
        if (priceElement) {
            if (count > 1) {
                priceElement.textContent = pricePerUnit.toLocaleString('ru-RU') + ' ₽/шт (' + count + ' шт.)';
            } else {
                priceElement.textContent = pricePerUnit.toLocaleString('ru-RU') + ' ₽/шт';
            }
        }
    });
}

// Функция обновления цен отдельных компонентов  
function updateIndividualComponentPrices() {
    const hourlyRate = safeGetValue('hourlyRate', 220);
     const methodistRole = safeGetValue('methodistRole', 1.0);
        const domainKnowledge = safeGetValue('domainKnowledge', 1.0);
        const projectType = safeGetValue('projectType', 1.0);
        const contentComplexity = safeGetValue('contentComplexity', 1.2);
        const urgency = safeGetValue('urgency', 1.0);
        const qualityLevel = safeGetValue('qualityLevel', 1.0);
    
    const complexityMultiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
    
    Object.keys(components).forEach(componentId => {
        const count = parseInt(safeGetValue(componentId + 'Count', 1));
        const baseHours = safeGetValue(componentId + 'Hours', components[componentId]?.defaultHours || 1);
        
        let volumeFactor = 1.0;
        if (componentId === 'longread') {
            const pages = safeGetValue('longreadPages', 1);
            volumeFactor = pages;
        } else if (componentId === 'quizzes') {
            const questions = parseInt(safeGetValue('quizzesQuestions', 7));
            volumeFactor = questions / 7;
        }
        
        const volumeDiscount = getVolumeDiscount(count);
        const adjustedHours = baseHours * volumeFactor * complexityMultiplier * qualityLevel * volumeDiscount;
        const pricePerUnit = Math.round(adjustedHours * hourlyRate);
        
        const priceElement = safeGetElement(componentId + 'Price');
        if (priceElement) {
            if (count > 1) {
                priceElement.textContent = pricePerUnit.toLocaleString('ru-RU') + ' ₽/шт (' + count + ' шт.)';
            } else {
                priceElement.textContent = pricePerUnit.toLocaleString('ru-RU') + ' ₽/шт';
            }
        }
    });
}

// Функция расчета скидки за объем
function getVolumeDiscount(quantity) {
    const enableVolumeDiscounts = safeGetElement('enableVolumeDiscounts')?.checked ?? true;
    
    if (!enableVolumeDiscounts) return 1.0;
    
    if (quantity <= 5) return 1.0;
    if (quantity <= 15) return 0.9;
    if (quantity <= 30) return 0.8;
    return 0.7;
}

// Функция расчета адаптивного коэффициента
function calculateAdaptiveMultiplier(domain, project, complexity, urgency, role) {
    const pricingMethod = safeGetRadioValue('pricingMethod', 'hourly');
    const detailLevel = safeGetRadioValue('detailLevel', 'quick');
    
    if (detailLevel === 'quick') {
        // Быстрый режим - используем объединенную сложность
        const projectComplexity = safeGetValue('projectComplexity', 1.3);
        let multiplier = projectComplexity * role;
        
        // Для фиксированных цен ограничиваем коэффициент
        if (pricingMethod === 'fixed') {
            multiplier = Math.min(multiplier, 1.5);
        }
        
        return multiplier;
    } else {
        // Детальный режим - используем детальную логику с ограничителями
        const weightedSum = 1.0 + 
            (domain - 1) * normalizedWeights.domain +
            (project - 1) * normalizedWeights.project +
            (complexity - 1) * normalizedWeights.complexity +
            (urgency - 1) * normalizedWeights.urgency;
        
        let result = weightedSum * role;
        
        if (pricingMethod === 'fixed') {
            // Для фиксированных цен - ограниченные коэффициенты
            result = Math.min(result, 1.5);
        } else {
            // Для почасового - полные коэффициенты с ограничителями
            if (result > 3.0) {
                result = 3.0 + (result - 3.0) * 0.3;
            }
            if (result > 4.0) {
                result = 4.0;
            }
        }
        
        return result;
    }
}

// Массив кастомных услуг
let customServices = [];
let customServiceCounter = 0;

// Отслеживание автоматически активированных услуг (только услуги, не компоненты!)
let autoActivatedServices = new Set();

// Автоматическая активация услуг
function handleServiceAutoActivation() {
    const domainKnowledge = safeGetValue('domainKnowledge', 1.0);
    const projectType = safeGetValue('projectType', 1.0);
    
    // Проверяем пресеты с видеоуроками
    const videoLessonCount = parseInt(safeGetValue('videoLessonPreset', 0));
    
    // Логика автоактивации услуг
    if (projectType === 1.0) {
        // Новая программа по моей методике → Исследование + Методические артефакты
        activateService('research', true);
        activateService('methodology', true);
    } else {
        // Доработка или чужая программа → Методический аудит
        activateService('audit', true);
        // Убираем исследование и методические артефакты если они были автоактивированы
        deactivateService('research');
        deactivateService('methodology');
    }
    
    // Автоактивация подготовки спикера для видеоуроков
    if (videoLessonCount > 0) {
        activateService('speakerPrep', true);
    } else {
        deactivateService('speakerPrep');
    }
    
    calculateCost();
}

function activateService(serviceId, isAuto) {
    const checkbox = safeGetElement(serviceId);
    if (!checkbox) return;
    
    const element = checkbox.closest('.service-item');
    if (!element) return;
    
    const quantityGroups = element.querySelectorAll('.quantity-input-group');

    if (!checkbox.checked) {
        checkbox.checked = true;
        if (isAuto) {
            element.classList.add('auto-selected');
            element.classList.remove('selected');
            autoActivatedServices.add(serviceId);
            updateAutoLabel(element, true);
        } else {
            element.classList.add('selected');
            element.classList.remove('auto-selected');
        }
        quantityGroups.forEach(group => group.classList.add('visible'));
    }
}

function deactivateService(serviceId) {
    if (!autoActivatedServices.has(serviceId)) return;
    
    const checkbox = safeGetElement(serviceId);
    if (!checkbox) return;
    
    const element = checkbox.closest('.service-item');
    if (!element) return;
    
    const quantityGroups = element.querySelectorAll('.quantity-input-group');

    checkbox.checked = false;
    element.classList.remove('auto-selected', 'selected');
    autoActivatedServices.delete(serviceId);
    updateAutoLabel(element, false);
    quantityGroups.forEach(group => group.classList.remove('visible'));
}

function updateAutoLabel(element, isAuto) {
    const title = element.querySelector('.service-title');
    if (!title) return;
    
    let label = title.querySelector('.auto-selected-label');

    if (isAuto && !label) {
        label = document.createElement('span');
        label.className = 'auto-selected-label';
        label.textContent = 'АВТО';
        title.appendChild(label);
    } else if (!isAuto && label) {
        label.remove();
    }
}

// Функции для кастомных услуг
function updateCustomServicePrice() {
    // Теперь цена редактируется пользователем напрямую
    // Эта функция больше не нужна для автоматического расчета
}

function addCustomService() {
    const name = safeGetElement('customServiceName')?.value.trim();
    const description = safeGetElement('customServiceDescription')?.value.trim();
    const hours = safeGetValue('customServiceHours', 1);
    const count = parseInt(safeGetValue('customServiceCount', 1));
    const price = safeGetValue('customServicePrice', 220);
    
    if (!name) {
        alert('Введите название услуги');
        return;
    }
    
    customServiceCounter++;
    const id = 'custom_' + customServiceCounter;
    
    const customService = {
        id: id,
        name: name,
        description: description,
        hours: hours,
        count: count,
        pricePerUnit: price
    };
    
    customServices.push(customService);
    renderCustomServices();
    clearCustomServiceForm();
    calculateCost();
}

function removeCustomService(id) {
    customServices = customServices.filter(service => service.id !== id);
    renderCustomServices();
    calculateCost();
}

function renderCustomServices() {
    const container = safeGetElement('customServicesList');
    if (!container) return;
    
    container.innerHTML = '';
    
    customServices.forEach(service => {
        const price = service.pricePerUnit;
        const totalCost = price * service.count;
        
        container.innerHTML += `
            <div class="service-item" style="background: #fef3c7; border-color: #f59e0b;">
                <div class="service-header">
                    <span class="service-title">${service.name}</span>
                    <span style="color: #d97706; font-weight: 600; font-size: 0.9rem;">${totalCost.toLocaleString('ru-RU')} ₽</span>
                </div>
                <div class="service-description">${service.description || 'Кастомная услуга'}</div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid #f3f4f6;">
                    <span style="font-size: 0.85rem; color: #6b7280;">${service.hours}ч × ${service.count}шт = ${price.toLocaleString('ru-RU')} ₽/шт</span>
                    <button onclick="removeCustomService('${service.id}')" style="padding: 4px 8px; background: #ef4444; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">Удалить</button>
                </div>
            </div>
        `;
    });
}

function clearCustomServiceForm() {
    const nameInput = safeGetElement('customServiceName');
    const descriptionInput = safeGetElement('customServiceDescription');
    const hoursInput = safeGetElement('customServiceHours');
    const countInput = safeGetElement('customServiceCount');
    
    if (nameInput) nameInput.value = '';
    if (descriptionInput) descriptionInput.value = '';
    if (hoursInput) hoursInput.value = '1';
    if (countInput) countInput.value = '1';
}

// Функции для работы с финансовыми настройками и подсказками
function updateDiscountDisplay() {
    const discountRate = parseInt(safeGetValue('discountRate', 0));
    const discountRateValue = safeGetElement('discountRateValue');
    const tooltip = safeGetElement('discountTooltipContent');
    
    if (discountRateValue) {
        if (discountRate === 0) {
            discountRateValue.textContent = '0% (без изменений)';
        } else if (discountRate > 0) {
            discountRateValue.textContent = `+${discountRate}% (наценка)`;
        } else {
            discountRateValue.textContent = `${discountRate}% (скидка)`;
        }
    }
    
    if (tooltip) {
        if (discountRate === 0) {
            tooltip.textContent = 'Без изменений';
        } else if (discountRate === -10) {
            tooltip.textContent = 'Постоянный клиент';
        } else if (discountRate === -15) {
            tooltip.textContent = 'Хорошие партнеры';
        } else if (discountRate === -20) {
            tooltip.textContent = 'Внутренний проект';
        } else if (discountRate > 0) {
            tooltip.textContent = 'Наценка за сложности';
        } else {
            tooltip.textContent = 'Индивидуальная скидка';
        }
    }
}

function updateTaxDisplay() {
    const taxRate = parseInt(safeGetValue('taxRate', 13));
    const taxRateValue = safeGetElement('taxRateValue');
    const tooltip = safeGetElement('taxTooltipContent');
    
    if (taxRateValue) {
        if (taxRate === 0) {
            taxRateValue.textContent = '0% (без налогов)';
        } else {
            taxRateValue.textContent = `${taxRate}%`;
        }
    }
    
    if (tooltip) {
        if (taxRate === 0) {
            tooltip.textContent = 'Самозанятый без налогов';
        } else if (taxRate === 4) {
            tooltip.textContent = 'Самозанятый с налогом';
        } else if (taxRate === 6) {
            tooltip.textContent = 'УСН доходы';
        } else if (taxRate === 13) {
            tooltip.textContent = 'НДФЛ для физлиц';
        } else if (taxRate === 15) {
            tooltip.textContent = 'УСН доходы-расходы';
        } else if (taxRate === 20) {
            tooltip.textContent = 'НДС + налог на прибыль';
        } else {
            tooltip.textContent = 'Индивидуальная ставка';
        }
    }
}

function showTooltip(tooltipId) {
    const tooltip = safeGetElement(tooltipId);
    if (tooltip) {
        tooltip.classList.add('show');
    }
}

function hideTooltip(tooltipId) {
    const tooltip = safeGetElement(tooltipId);
    if (tooltip) {
        tooltip.classList.remove('show');
    }
}

// Система умных подсказок
    function addSmartTooltips() {
        // Добавляем подсказку к упрощенному расчету
        const simpleCalcLabel = document.querySelector('label[for="simpleCalculation"]');
        if (simpleCalcLabel && !simpleCalcLabel.querySelector('.smart-tooltip')) {
            const tooltip = document.createElement('span');
            tooltip.className = 'smart-tooltip';
            tooltip.innerHTML = ' <span style="color: #6b7280; cursor: help;" title="Отключает все коэффициенты сложности. Используйте для быстрой оценки или простых проектов">❓</span>';
            simpleCalcLabel.appendChild(tooltip);
        }
        
        // Добавляем подсказку к роли методиста
        const methodistLabel = document.querySelector('label[for="methodistRole"]');
        if (methodistLabel && !methodistLabel.querySelector('.smart-tooltip')) {
            const tooltip = document.createElement('span');
            tooltip.className = 'smart-tooltip';
            tooltip.innerHTML = ' <span style="color: #6b7280; cursor: help;" title="Автор создает контент с нуля. Редактор проверяет готовый контент (50% ставки)">❓</span>';
            methodistLabel.appendChild(tooltip);
        }
        
        // Добавляем индикатор экономии для скидок за объем
        updateVolumeDiscountIndicators();
    }
    
    function updateVolumeDiscountIndicators() {
        document.querySelectorAll('.preset-quantity-input').forEach(input => {
            const value = parseInt(input.value) || 0;
            let discountText = '';
            
            if (value > 30) discountText = ' 💰 -30%';
            else if (value > 15) discountText = ' 💰 -20%';
            else if (value > 5) discountText = ' 💰 -10%';
            
            // Удаляем старый индикатор
            const existingIndicator = input.parentNode.querySelector('.volume-discount');
            if (existingIndicator) existingIndicator.remove();
            
            // Добавляем новый, если есть скидка
            if (discountText) {
                const indicator = document.createElement('span');
                indicator.className = 'volume-discount';
                indicator.style.cssText = 'color: #10b981; font-size: 0.8rem; font-weight: 600; margin-left: 5px;';
                indicator.textContent = discountText;
                input.parentNode.appendChild(indicator);
            }
        });
    }

	// Функция для безопасного получения элемента
    function safeGetElement(id) {
        const element = document.getElementById(id);
        if (!element) {
            console.warn('Element not found:', id);
        }
        return element;
    }

// Функция для безопасного получения значения
    function safeGetValue(id, defaultValue = 0) {
        const element = safeGetElement(id);
        if (!element) return defaultValue;
        
        // Для селектора calculationMode возвращаем строку, а не число
        if (id === 'calculationMode') {
            console.log('Getting calculationMode value:', element.value);
            return element.value;
        }
        
        const value = parseFloat(element.value);
        return isNaN(value) ? defaultValue : value;
    }

// Система валидации и предупреждений
    function showWarning(message, type = 'warning') {
        // Удаляем предыдущие предупреждения
        const existingWarning = document.querySelector('.calc-warning');
        if (existingWarning) {
            existingWarning.remove();
        }
        
        // Создаем новое предупреждение
        const warning = document.createElement('div');
        warning.className = `calc-warning calc-${type}`;
        warning.innerHTML = `
            <div style="background: ${type === 'error' ? '#fee2e2' : '#fef3c7'}; 
                        border: 1px solid ${type === 'error' ? '#fca5a5' : '#fbbf24'}; 
                        color: ${type === 'error' ? '#dc2626' : '#d97706'}; 
                        padding: 12px; 
                        border-radius: 8px; 
                        margin: 10px 0; 
                        font-size: 0.9rem;
                        display: flex;
                        align-items: center;
                        gap: 8px;">
                <span>${type === 'error' ? '⚠️' : 'ℹ️'}</span>
                <span>${message}</span>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="margin-left: auto; background: none; border: none; 
                               font-size: 1.2rem; cursor: pointer; color: inherit;">×</button>
            </div>
        `;
        
        // Вставляем после заголовка "Базовые параметры"
        const targetSection = document.querySelector('.section-title');
        if (targetSection) {
            targetSection.parentNode.insertBefore(warning, targetSection.nextSibling);
        }
        
        // Автоматически убираем через 10 секунд
        setTimeout(() => {
            if (warning && warning.parentNode) {
                warning.remove();
            }
        }, 10000);
    }

    function validateInputs() {
        const hourlyRate = safeGetValue('hourlyRate', 220);
        const totalHours = parseFloat(document.getElementById('totalHours')?.textContent || '0');
        
        // Проверка ставки
        if (hourlyRate < 100) {
            showWarning('Ставка менее 100₽/час может быть слишком низкой для качественной работы', 'warning');
        } else if (hourlyRate > 10000) {
            showWarning('Очень высокая ставка. Убедитесь, что это соответствует рынку', 'warning');
        }
        
        // Проверка объема работ
        if (totalHours > 200) {
            showWarning('Очень большой объем работ (>200ч). Рекомендуется разбить на этапы', 'warning');
        } else if (totalHours > 500) {
            showWarning('Критически большой объем! Обязательно разбейте на несколько этапов', 'error');
        }
        
        // Проверка логических противоречий
        const detailLevel = safeGetRadioValue('detailLevel', 'quick');
const simpleCalc = (detailLevel === 'quick');
        const newDomain = safeGetValue('domainKnowledge', 1.0) === 1.3;
        const complexContent = safeGetValue('contentComplexity', 1.2) > 1.4;
        
        if (simpleCalc && (newDomain || complexContent)) {
            showWarning('Упрощенный расчет не учитывает сложность. Рекомендуется отключить для точности', 'warning');
        }
    }

// Обновление информационной панели
function updateCalculationInfo() {
    const pricingMethod = safeGetRadioValue('pricingMethod', 'hourly');
    const detailLevel = safeGetRadioValue('detailLevel', 'quick');
    const simpleCalc = (detailLevel === 'quick');
    const volumeDiscounts = safeGetElement('enableVolumeDiscounts')?.checked ?? true;
    const description = safeGetElement('calculationDescription');
    
    if (description) {
        let text = '';
        
        // Метод ценообразования
        if (pricingMethod === 'fixed') {
            text += `<strong>Метод:</strong> Фиксированные цены для пресетов<br>`;
            text += `<strong>Логика:</strong> Базовая цена + коррекция длительности + общая надбавка за сложность<br>`;
            text += `<strong>Компоненты/услуги:</strong> Почасовой расчет<br>`;
        } else {
            text += `<strong>Метод:</strong> Полностью почасовой расчет<br>`;
            if (detailLevel === 'quick') {
                text += `<strong>Ограничения:</strong> Коэффициенты до 3.0x<br>`;
            } else {
                text += `<strong>Ограничения:</strong> Коэффициенты до 4.0x<br>`;
            }
        }
        
        // Уровень детализации
        if (detailLevel === 'quick') {
            text += `<strong>Детализация:</strong> Быстрая (единый селектор сложности)<br>`;
        } else {
            text += `<strong>Детализация:</strong> Подробная (все факторы отдельно)<br>`;
        }
        
        text += `<strong>Коэффициенты сложности:</strong> ${simpleCalc ? 'Отключены' : 'Включены'}<br>`;
        text += `<strong>Скидки за объем:</strong> ${volumeDiscounts ? 'Включены (6-15шт: -10%, 16-30шт: -20%, 31+шт: -30%)' : 'Отключены'}`;
        
        if (simpleCalc) {
            text += '<br><span style="color: #d97706;">⚠️ Упрощенный расчет игнорирует настройки сложности</span>';
        }
        
        description.innerHTML = text;
    }
}

    function showComponentQuantities(componentId, show) {
        const quantities = document.querySelectorAll('#' + componentId + 'Quantity, #' + componentId + 'CountGroup, #' + componentId + 'PagesGroup, #' + componentId + 'QuestionsGroup');
        quantities.forEach(qty => {
            if (show) {
                qty.classList.add('visible');
            } else {
                qty.classList.remove('visible');
            }
        });
    }

    function showServiceQuantities(serviceId, show) {
        const groups = document.querySelectorAll('#' + serviceId + 'HoursGroup, #' + serviceId + 'CountGroup');
        groups.forEach(group => {
            if (show) {
                group.classList.add('visible');
            } else {
                group.classList.remove('visible');
            }
        });
    }

	function applyPreset(presetType) {
    const preset = presets[presetType];
    if (!preset) return;
    
    const count = parseInt(safeGetValue(presetType + 'Preset', 0));
    const presetElement = document.querySelector('[data-preset="' + presetType + '"]');

    // Просто обновляем визуальное состояние пресета
    if (count > 0) {
        if (presetElement) {
            presetElement.classList.add('active');
        }
    } else {
        if (presetElement) {
            presetElement.classList.remove('active');
        }
    }

    handleServiceAutoActivation();
}

    function toggleComponent(element, componentId) {
    const checkbox = element.querySelector('input[type="checkbox"]');
    if (!checkbox) return;

    checkbox.checked = !checkbox.checked;

    if (checkbox.checked) {
        element.classList.add('selected');
        element.classList.remove('auto-selected');
        showComponentQuantities(componentId, true);
    } else {
        element.classList.remove('selected', 'auto-selected');
        showComponentQuantities(componentId, false);
    }

    calculateCost();
}

   function toggleService(element, serviceId) {
    const checkbox = element.querySelector('input[type="checkbox"]');
    if (!checkbox) return;

    checkbox.checked = !checkbox.checked;

    if (checkbox.checked) {
        if (autoActivatedServices.has(serviceId)) {
            element.classList.add('auto-selected');
            element.classList.remove('selected');
        } else {
            element.classList.add('selected');
            element.classList.remove('auto-selected');
        }
        showServiceQuantities(serviceId, true);
    } else {
        element.classList.remove('selected', 'auto-selected');
        autoActivatedServices.delete(serviceId);
        showServiceQuantities(serviceId, false);
        updateAutoLabel(element, false);
    }

    calculateCost();
}
	function calculateCost() {
      const hourlyRate = safeGetValue('hourlyRate', 220);
		let complexityBonus = 0; // Объявляем в начале функции
     const methodistRole = safeGetValue('methodistRole', 1.0);
        const domainKnowledge = safeGetValue('domainKnowledge', 1.0);
        const projectType = safeGetValue('projectType', 1.0);
        const contentComplexity = safeGetValue('contentComplexity', 1.2);
        const urgency = safeGetValue('urgency', 1.0);
        const qualityLevel = safeGetValue('qualityLevel', 1.0);
        const clientType = parseInt(safeGetValue('clientType', 20));
        const pricingMethod = safeGetRadioValue('pricingMethod', 'hourly');

        // Расчет компонентов контента
        let componentCosts = [];
        let totalContentCost = 0;
        let totalContentHours = 0;

        // Проверка активных пресетов
        const activePresets = Object.keys(presets).filter(preset => {
            const count = parseInt(safeGetValue(preset + 'Preset', 0));
            return count > 0;
        });

       activePresets.forEach(presetType => {
            const count = parseInt(safeGetValue(presetType + 'Preset', 0));
            const presetDuration = parseInt(safeGetValue(presetType + 'Duration', presets[presetType].defaultDuration));
            
            let cost;
            let adjustedHours;
            
            if (pricingMethod === 'fixed') {
                // Расчет по фиксированным ценам (только длительность + объем)
                const basePrice = fixedPrices[presetType].current;
                const durationFactor = presetDuration / fixedPrices[presetType].baseDuration;
                const volumeDiscount = getVolumeDiscount(count);
                
                const pricePerUnit = basePrice * durationFactor * volumeDiscount;
                cost = pricePerUnit * count;
                adjustedHours = cost / hourlyRate; // Примерное время для отчетности
            } else {
                // Почасовой расчет (как было)
                const durationFactor = presetDuration / presets[presetType].defaultDuration;
                let baseHours = 0;

                presets[presetType].components.forEach(componentId => {
                    const hours = safeGetValue(componentId + 'Hours', components[componentId]?.defaultHours || 1);
                    baseHours += hours;
                });

                const complexityMultiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
                const volumeDiscount = getVolumeDiscount(count);
                adjustedHours = baseHours * durationFactor * complexityMultiplier * qualityLevel * volumeDiscount;
                cost = adjustedHours * count * hourlyRate;
            }

            componentCosts.push({
    name: presets[presetType].name,
    count: count,
    hours: adjustedHours,
    cost: cost,
    source: 'preset'
});

            totalContentCost += cost;
            totalContentHours += adjustedHours * count;
        });

        // Расчет дополнительных компонентов (независимо от пресетов)
Object.keys(components).forEach(componentId => {
    const checkbox = safeGetElement(componentId);
    if (!checkbox?.checked) return;

            const count = parseInt(safeGetValue(componentId + 'Count', 1));
            const baseHours = safeGetValue(componentId + 'Hours', components[componentId].defaultHours);

            let volumeFactor = 1.0;
            if (componentId === 'longread') {
                const pages = safeGetValue('longreadPages', 1);
                volumeFactor = pages;
            } else if (componentId === 'quizzes') {
                const questions = parseInt(safeGetValue('quizzesQuestions', 7));
                volumeFactor = questions / 7;
            }

           const multiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
            const volumeDiscount = getVolumeDiscount(count);
         const adjustedHours = baseHours * volumeFactor * multiplier * qualityLevel * volumeDiscount;
            const cost = adjustedHours * count * hourlyRate;

            componentCosts.push({
    name: components[componentId].name,
    count: count,
    hours: adjustedHours,
    cost: cost,
    source: 'additional'
});

            totalContentCost += cost;
            totalContentHours += adjustedHours * count;
        });

	// Расчет проверок знаний
        let assessmentCosts = [];
        let totalAssessmentCost = 0;
        let totalAssessmentHours = 0;

        Object.keys(assessments).forEach(serviceId => {
            const checkbox = safeGetElement(serviceId);
            if (!checkbox?.checked) return;
            
            const count = parseInt(safeGetValue(serviceId + 'Count', 1));
            const hours = safeGetValue(serviceId + 'Hours', assessments[serviceId].defaultHours);
            const multiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
const adjustedHours = hours * multiplier;
            const cost = adjustedHours * count * hourlyRate;

            assessmentCosts.push({
                name: assessments[serviceId].name,
                count: count,
                hours: adjustedHours,
                cost: cost
            });

            totalAssessmentCost += cost;
            totalAssessmentHours += adjustedHours * count;
        });

        // Расчет дополнительных услуг
        let serviceCosts = [];
        let totalServiceCost = 0;
        let totalServiceHours = 0;

        Object.keys(services).forEach(serviceId => {
            const checkbox = safeGetElement(serviceId);
            if (!checkbox?.checked) return;
            
            const hours = safeGetValue(serviceId + 'Hours', services[serviceId].defaultHours);
            const cost = hours * hourlyRate;

            serviceCosts.push({
                name: services[serviceId].name,
                count: 1,
                hours: hours,
                cost: cost
            });

            totalServiceCost += cost;
            totalServiceHours += hours;
        });

// Добавляем кастомные услуги
customServices.forEach(service => {
    const cost = service.pricePerUnit * service.count;
    
    serviceCosts.push({
        name: service.name,
        count: service.count,
        hours: service.hours,
        cost: cost,
        source: 'custom'
    });
    
    totalServiceCost += cost;
    totalServiceHours += service.hours * service.count;
});

      // Расчет надбавки за сложность для фиксированных цен
if (pricingMethod === 'fixed' && totalContentCost > 0) {
    const complexityMultiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
    if (complexityMultiplier > 1.0) {
        complexityBonus = totalContentCost * (complexityMultiplier - 1.0);
    }
}

// Расчет правок
const revisionFactor = clientType / 100;
const contentWithRevisions = totalContentCost * (1 + revisionFactor);
const assessmentsWithRevisions = totalAssessmentCost * (1 + revisionFactor);
const subtotalBeforeFinancials = contentWithRevisions + assessmentsWithRevisions + totalServiceCost + complexityBonus;

// Применяем скидку/наценку к общей сумме
const discountRate = safeGetValue('discountRate', 0) / 100;
const discountAmount = subtotalBeforeFinancials * discountRate;
const afterDiscount = subtotalBeforeFinancials + discountAmount;

// Применяем налог к сумме после скидки
const taxRate = safeGetValue('taxRate', 13) / 100;
const taxAmount = afterDiscount * taxRate;
const totalCost = afterDiscount + taxAmount;

// Для совместимости с интерфейсом
const subtotal = subtotalBeforeFinancials;

// Расчет общего времени
const totalHours = totalContentHours + totalAssessmentHours + totalServiceHours;

// Обновление цен в пресетах и компонентах
        updatePresetPrices();
        updateIndividualComponentPrices();

        // Обновление интерфейса
        console.log('Financial data:', { subtotal, discountAmount, afterDiscount, taxAmount, discountRate: safeGetValue('discountRate', 0), taxRate: safeGetValue('taxRate', 13) });
        updateResults(totalCost, totalHours, componentCosts, assessmentCosts, serviceCosts, activePresets, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount, complexityBonus, pricingMethod);
        
        // Запускаем валидацию после обновления результатов
        setTimeout(validateInputs, 100);
    }

   function updateResults(totalCost, totalHours, componentCosts, assessmentCosts, serviceCosts, activePresets, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount, complexityBonus, pricingMethod) {
        // Обновление основных результатов
        const totalCostElement = safeGetElement('totalCost');
        const totalHoursElement = safeGetElement('totalHours');
        
        if (totalCostElement) {
            totalCostElement.textContent = Math.round(totalCost).toLocaleString('ru-RU') + ' ₽';
        }
        
        if (totalHoursElement) {
            totalHoursElement.textContent = (Math.round(totalHours * 10) / 10) + ' ч';
        }

        // Обновление состава проекта
        updateProjectComposition(activePresets, componentCosts, assessmentCosts, serviceCosts);

        // Обновление детализации
        updateBreakdown(totalCost, componentCosts, assessmentCosts, serviceCosts, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount, complexityBonus, pricingMethod);
    }

    function updateProjectComposition(activePresets, componentCosts, assessmentCosts, serviceCosts) {
        const projectComposition = safeGetElement('projectComposition');
        if (!projectComposition) return;

        projectComposition.innerHTML = '';
        
        if (activePresets.length > 0 || componentCosts.length > 0 || assessmentCosts.length > 0 || serviceCosts.length > 0) {
            activePresets.forEach(preset => {
                const count = parseInt(safeGetValue(preset + 'Preset', 0));
                const duration = parseInt(safeGetValue(preset + 'Duration', presets[preset]?.defaultDuration || 30));
                const presetName = presets[preset]?.name || preset;
                projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + presetName + ' (' + count + ' шт., ' + duration + ' мин)</span></div>';
            });
            
            componentCosts.forEach(item => {
    if (item.source === 'additional') {
        projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span></div>';
    }
});
            
            assessmentCosts.forEach(item => {
                projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span></div>';
            });
            
            serviceCosts.forEach(item => {
                projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + '</span></div>';
            });
        } else {
            projectComposition.innerHTML = '<div style="color: #6b7280; font-style: italic;">Выберите компоненты или используйте пресеты</div>';
        }
    }

function updateBreakdown(totalCost, componentCosts, assessmentCosts, serviceCosts, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount, complexityBonus, pricingMethod) {
        const breakdown = safeGetElement('breakdown');
        if (!breakdown) return;

        breakdown.innerHTML = '';
        
        if (totalCost > 0) {
            // Показываем компоненты
if (componentCosts.length > 0) {
    // Разделяем на пресеты и дополнительные компоненты
    const presetItems = componentCosts.filter(item => item.source === 'preset');
    const additionalItems = componentCosts.filter(item => item.source === 'additional');
    
    if (presetItems.length > 0) {
        breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Пресеты</div>';
        presetItems.forEach(item => {
            const cost = Math.round(item.cost).toLocaleString('ru-RU');
            breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
        });
        breakdown.innerHTML += '</div>';
    }
    
    if (additionalItems.length > 0) {
        breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Дополнительные компоненты</div>';
        additionalItems.forEach(item => {
            const cost = Math.round(item.cost).toLocaleString('ru-RU');
            breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
        });
        breakdown.innerHTML += '</div>';
    }
}
            
            // Показываем проверки знаний
            if (assessmentCosts.length > 0) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Проверки знаний</div>';
                assessmentCosts.forEach(item => {
                    const cost = Math.round(item.cost).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
                });
                breakdown.innerHTML += '</div>';
            }
            
            // Показываем дополнительные услуги
            if (serviceCosts.length > 0) {
                const standardServices = serviceCosts.filter(item => item.source !== 'custom');
                const customServiceItems = serviceCosts.filter(item => item.source === 'custom');
                
                if (standardServices.length > 0) {
                    breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Дополнительные услуги</div>';
                    standardServices.forEach(item => {
                        const cost = Math.round(item.cost).toLocaleString('ru-RU');
                        breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + '</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
                    });
                    breakdown.innerHTML += '</div>';
                }
                
                if (customServiceItems.length > 0) {
                    breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Кастомные услуги</div>';
                    customServiceItems.forEach(item => {
                        const cost = Math.round(item.cost).toLocaleString('ru-RU');
                        const countText = item.count > 1 ? ` (${item.count} шт.)` : '';
                        breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + countText + '</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
                    });
                    breakdown.innerHTML += '</div>';
                }
            }
            
            // Показываем правки ТОЛЬКО если они есть
            if (revisionFactor > 0 && (componentCosts.length > 0 || assessmentCosts.length > 0)) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Правки</div>';
                
                if (componentCosts.length > 0) {
                    const totalContentCost = componentCosts.reduce((sum, item) => sum + item.cost, 0);
                    const revisionCost = Math.round(totalContentCost * revisionFactor).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Правки контента (' + clientType + '%)</span><span class="breakdown-right">+' + revisionCost + ' ₽</span></div>';
                }
                
                if (assessmentCosts.length > 0) {
                    const totalAssessmentCost = assessmentCosts.reduce((sum, item) => sum + item.cost, 0);
                    const revisionCost = Math.round(totalAssessmentCost * revisionFactor).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Правки проверок (' + clientType + '%)</span><span class="breakdown-right">+' + revisionCost + ' ₽</span></div>';
                }
                
                breakdown.innerHTML += '</div>';
            }
            
            // Показываем финансовые расчеты ТОЛЬКО если есть скидки или налоги
            const discountRate = safeGetValue('discountRate', 0);
            const taxRate = safeGetValue('taxRate', 13);
            const showTaxSeparately = safeGetElement('showTaxSeparately')?.checked || false;

// Убеждаемся что complexityBonus определен
if (typeof complexityBonus === 'undefined') {
    complexityBonus = 0;
}
		
// Показываем надбавку за сложность ТОЛЬКО для фиксированных цен
            if (pricingMethod === 'fixed' && complexityBonus > 0) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Надбавка за сложность</div>';
                breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Коэффициент сложности проекта</span><span class="breakdown-right">+' + Math.round(complexityBonus).toLocaleString('ru-RU') + ' ₽</span></div>';
                breakdown.innerHTML += '</div>';
            }
		
            if (discountRate !== 0 || (taxRate > 0 && showTaxSeparately)) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Финансовые расчеты</div>';
                
                // Подытог
                breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Подытог</span><span class="breakdown-right">' + Math.round(subtotal).toLocaleString('ru-RU') + ' ₽</span></div>';
                
                // Скидка/наценка
                if (discountRate !== 0) {
                    const discountText = discountRate > 0 ? `Наценка (+${discountRate}%)` : `Скидка (${discountRate}%)`;
                    const discountSign = discountAmount > 0 ? '+' : '';
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + discountText + '</span><span class="breakdown-right">' + discountSign + Math.round(discountAmount).toLocaleString('ru-RU') + ' ₽</span></div>';
                }
                
                // Налог
                if (taxRate > 0 && showTaxSeparately) {
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Налог (' + taxRate + '%)</span><span class="breakdown-right">+' + Math.round(taxAmount).toLocaleString('ru-RU') + ' ₽</span></div>';
                }
                
                breakdown.innerHTML += '</div>';
            }
            
            // Итого
            const totalLabel = (taxRate > 0 && !showTaxSeparately) ? 'Итого (с налогом)' : 'Итого';
            breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + totalLabel + '</span><span class="breakdown-right">' + Math.round(totalCost).toLocaleString('ru-RU') + ' ₽</span></div>';
        } else {
            breakdown.innerHTML = '<div style="color: #6b7280; font-style: italic;">Расчет появится после выбора компонентов</div>';
        }
    }     

    // Добавление обработчиков событий
    function initializeEventListeners() {
// Обработчики для радиокнопок
        const pricingMethodRadios = document.querySelectorAll('input[name="pricingMethod"]');
        const detailLevelRadios = document.querySelectorAll('input[name="detailLevel"]');
        
        pricingMethodRadios.forEach(radio => {
            radio.addEventListener('change', updateInterfaceVisibility);
        });
        
        detailLevelRadios.forEach(radio => {
            radio.addEventListener('change', updateInterfaceVisibility);
        });

        // Обработчики для основных параметров
        const basicInputs = ['hourlyRate', 'enableVolumeDiscounts', 'projectComplexity', 'methodistRole', 'domainKnowledge', 'projectType', 'contentComplexity', 'urgency', 'qualityLevel', 'clientType', 'showTaxSeparately'];
// Обработчик для подсказок сложности проекта
        const projectComplexitySelect = safeGetElement('projectComplexity');
        if (projectComplexitySelect) {
            projectComplexitySelect.addEventListener('change', updateComplexityHint);
        }
// Обработчики для кастомных услуг
        const customHoursInput = safeGetElement('customServiceHours');
        const customCountInput = safeGetElement('customServiceCount');
        
        if (customHoursInput) {
            customHoursInput.addEventListener('input', updateCustomServicePrice);
        }
        
        if (customCountInput) {
            customCountInput.addEventListener('input', updateCustomServicePrice);
        }
        
        // Обработчик Enter для добавления кастомной услуги
        const customNameInput = safeGetElement('customServiceName');
        if (customNameInput) {
            customNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addCustomService();
                }
            });
        }
        basicInputs.forEach(inputId => {
            const element = safeGetElement(inputId);
            if (element) {
                element.addEventListener('input', () => {
    updateCalculationInfo();
    handleServiceAutoActivation();
});
                element.addEventListener('change', () => {
    updateCalculationInfo();
    handleServiceAutoActivation();
});
            }
        });

// Обработчики для полей фиксированных цен
        Object.keys(fixedPrices).forEach(presetType => {
            const priceInput = safeGetElement('fixedPrice_' + presetType);
            if (priceInput) {
                priceInput.addEventListener('input', () => {
                    fixedPrices[presetType].current = parseFloat(priceInput.value) || fixedPrices[presetType].default;
                    calculateCost();
                });
            }
        });

// Обработчики для финансовых ползунков
const discountSlider = safeGetElement('discountRate');
if (discountSlider) {
    discountSlider.addEventListener('input', () => {
        updateDiscountDisplay();
        calculateCost();
    });
    
    discountSlider.addEventListener('mouseenter', () => showTooltip('discountTooltip'));
    discountSlider.addEventListener('mouseleave', () => hideTooltip('discountTooltip'));
    discountSlider.addEventListener('focus', () => showTooltip('discountTooltip'));
    discountSlider.addEventListener('blur', () => hideTooltip('discountTooltip'));
}

const taxSlider = safeGetElement('taxRate');
if (taxSlider) {
    taxSlider.addEventListener('input', () => {
        updateTaxDisplay();
        calculateCost();
    });
    
    taxSlider.addEventListener('mouseenter', () => showTooltip('taxTooltip'));
    taxSlider.addEventListener('mouseleave', () => hideTooltip('taxTooltip'));
    taxSlider.addEventListener('focus', () => showTooltip('taxTooltip'));
    taxSlider.addEventListener('blur', () => hideTooltip('taxTooltip'));
}

        // Обработчики для пресетов
        document.querySelectorAll('.preset-item').forEach(preset => {
            const presetType = preset.getAttribute('data-preset');
            if (!presetType) return;
            
            // Клик по самому пресету
            preset.addEventListener('click', (e) => {
                // Проверяем, что клик не по input полю
                if (e.target.tagName === 'INPUT') return;
                
                const countInput = safeGetElement(presetType + 'Preset');
                if (countInput) {
                    const currentCount = parseInt(countInput.value) || 0;
                    countInput.value = currentCount === 0 ? 1 : 0;
                       applyPreset(presetType);
                    calculateCost();
                }
            });

            // Обработчики для input полей в пресетах
            preset.querySelectorAll('.preset-quantity-input').forEach(input => {
                input.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                input.addEventListener('input', () => {
                    applyPreset(presetType);
                    updatePresetPrices();
                    calculateCost();
                });
            });
        });

        // Обработчики для компонентов
        document.querySelectorAll('.component-item').forEach(item => {
            const componentId = item.getAttribute('data-component');
            if (!componentId) return;
            
            // Клик по компоненту
            item.addEventListener('click', (e) => {
                // Проверяем, что клик не по input полю
                if (e.target.tagName === 'INPUT') return;
                
                toggleComponent(item, componentId);
            });

            // Обработчики для input полей в компонентах
            item.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
input.addEventListener('input', () => {
                    if (input.id.includes('Hours')) {
                        const displayElement = safeGetElement(componentId + 'HoursDisplay');
                        if (displayElement) {
                            displayElement.textContent = parseFloat(input.value).toFixed(1) + 'ч/шт';
                        }
                    }
                    calculateCost();
                });
            });

            // Обработчик для чекбокса
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                checkbox.addEventListener('change', () => {
    if (checkbox.checked) {
        item.classList.add('selected');
        showComponentQuantities(componentId, true);
    } else {
        item.classList.remove('selected', 'auto-selected');
        showComponentQuantities(componentId, false);
    }
    calculateCost();
});
            }
        });

        // Обработчики для услуг
        document.querySelectorAll('.service-item').forEach(item => {
            const serviceId = item.getAttribute('data-service');
            if (!serviceId) return;
            
            // Клик по услуге
            item.addEventListener('click', (e) => {
                // Проверяем, что клик не по input полю
                if (e.target.tagName === 'INPUT') return;
                
                toggleService(item, serviceId);
            });

            // Обработчики для input полей в услугах
            item.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                input.addEventListener('input', () => {
                    if (input.id.includes('Hours')) {
                        const displayElement = safeGetElement(serviceId + 'HoursDisplay');
                        if (displayElement) {
                            const suffix = assessments[serviceId] ? 'ч/шт' : 'ч';
                            displayElement.textContent = parseFloat(input.value).toFixed(1) + suffix;
                        }
                    }
                    calculateCost();
                });
            });

            // Обработчик для чекбокса
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        item.classList.add('selected');
                        showServiceQuantities(serviceId, true);
                    } else {
                        item.classList.remove('selected', 'auto-selected');
                        showServiceQuantities(serviceId, false);
                    }
                    calculateCost();
                });
            }
        });
    }

// Функция генерации текста для клиента
function generateClientText() {
    const hourlyRate = safeGetValue('hourlyRate', 220);
    const totalCostElement = safeGetElement('totalCost');
    const totalHoursElement = safeGetElement('totalHours');
    
    if (!totalCostElement || !totalHoursElement) return '';
    
    const totalCost = totalCostElement.textContent;
    const totalHours = totalHoursElement.textContent;
    
    let text = `РАСЧЕТ СТОИМОСТИ МЕТОДИЧЕСКИХ УСЛУГ\n`;
    text += `Дата: ${new Date().toLocaleDateString('ru-RU')}\n\n`;
    
    // Состав проекта
    const projectComposition = safeGetElement('projectComposition');
    if (projectComposition && projectComposition.innerHTML.trim() && !projectComposition.innerHTML.includes('italic')) {
        text += `СОСТАВ ПРОЕКТА:\n`;
        const items = projectComposition.querySelectorAll('.breakdown-item .breakdown-left');
        items.forEach(item => {
            text += `• ${item.textContent}\n`;
        });
        text += `\n`;
    }
    
    // Детализация
    const breakdown = safeGetElement('breakdown');
    if (breakdown && breakdown.innerHTML.trim() && !breakdown.innerHTML.includes('italic')) {
        text += `ДЕТАЛЬНАЯ СМЕТА:\n\n`;
        
        const sections = breakdown.querySelectorAll('.breakdown-section');
        sections.forEach(section => {
            const title = section.querySelector('.breakdown-section-title');
            if (title) {
                text += `${title.textContent.toUpperCase()}:\n`;
                const items = section.querySelectorAll('.breakdown-item');
                items.forEach(item => {
                    const left = item.querySelector('.breakdown-left');
                    const right = item.querySelector('.breakdown-right');
                    if (left && right) {
                        text += `  ${left.textContent} — ${right.textContent}\n`;
                    }
                });
                text += `\n`;
            }
        });
        
        // Итого
        const totalItem = breakdown.querySelector('.breakdown-item:last-child');
        if (totalItem) {
            const left = totalItem.querySelector('.breakdown-left');
            const right = totalItem.querySelector('.breakdown-right');
            if (left && right) {
                text += `${left.textContent.toUpperCase()}: ${right.textContent}\n`;
            }
        }
    }
    
    text += `\nОБЩИЕ ПОКАЗАТЕЛИ:\n`;
    text += `• Общее время выполнения: ${totalHours}\n`;
    text += `• Итоговая стоимость: ${totalCost}\n\n`;
    
    text += `УСЛОВИЯ:\n`;
    text += `• Часовая ставка: ${hourlyRate} ₽/час\n`;
    text += `• Оплата по факту выполнения этапов\n`;
    text += `• Сроки уточняются при заключении договора\n`;
    text += `• Стоимость действительна в течение 30 дней\n\n`;
    
    text += `Данный расчет носит предварительный характер.\n`;
    text += `Финальная стоимость может быть скорректирована после детального обсуждения требований.`;
    
    return text;
}

// Функция копирования в буфер обмена
function copyCalculationToClipboard() {
    const text = generateClientText();
    
    if (!text) {
        alert('Сначала настройте параметры и выберите компоненты');
        return;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        const status = safeGetElement('copyStatus');
        if (status) {
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
    }).catch(err => {
        console.error('Ошибка копирования: ', err);
        // Fallback для старых браузеров
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const status = safeGetElement('copyStatus');
        if (status) {
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
    });
}


// Инициализация приложения
function initialize() {
        updateInterfaceVisibility();
        updateComplexityHint();
        initializeEventListeners();
        updateDiscountDisplay();
        updateTaxDisplay();
        updateIndividualComponentPrices();
        updateCustomServicePrice();
        handleServiceAutoActivation();
    }

    // Запуск после загрузки DOM
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
</script>
    
</body>
</html>
