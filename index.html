<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор методических услуг 1.0</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
        }
        
        .form-section {
            padding: 40px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .result-section {
            background: #f8fafc;
            padding: 40px;
            border-left: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }
        
        .slider-group {
            margin-bottom: 25px;
        }
        
        .slider-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .slider-group input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            outline: none;
            transition: background 0.3s;
        }
        
        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4f46e5;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4f46e5;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-value {
            margin-top: 8px;
            font-size: 14px;
            color: #6b7280;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group label {
            font-weight: 600;
            color: #374151;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .info-card {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-card h4 {
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .info-card p {
            color: #0369a1;
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
        }
        
        .preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .preset-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .preset-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .preset-item.active {
    /* Стили будут переопределены цветовым кодированием выше */
}

/* Цветовое кодирование пресетов при ховере */
.preset-item[data-preset="textLesson"]:hover {
    border-color: #64748b;
    background: rgba(59, 130, 246, 0.08);
}

.preset-item[data-preset="videoLesson"]:hover {
    border-color: #7c3aed;
    background: rgba(139, 92, 246, 0.08);
}

.preset-item[data-preset="webinar"]:hover {
    border-color: #be185d;
    background: rgba(236, 72, 153, 0.08);
}

.preset-item[data-preset="workshop"]:hover {
    border-color: #047857;
    background: rgba(16, 185, 129, 0.08);
}

.preset-item[data-preset="caseStudy"]:hover {
    border-color: #d97706;
    background: rgba(245, 158, 11, 0.08);
}

.preset-item[data-preset="masterClass"]:hover {
    border-color: #dc2626;
    background: rgba(239, 68, 68, 0.08);
}

/* Активное состояние с цветовым кодированием */
.preset-item[data-preset="textLesson"].active {
    border-color: #64748b;
    background: rgba(59, 130, 246, 0.12);
}

.preset-item[data-preset="videoLesson"].active {
    border-color: #7c3aed;
    background: rgba(139, 92, 246, 0.12);
}

.preset-item[data-preset="webinar"].active {
    border-color: #be185d;
    background: rgba(236, 72, 153, 0.12);
}

.preset-item[data-preset="workshop"].active {
    border-color: #047857;
    background: rgba(16, 185, 129, 0.12);
}

.preset-item[data-preset="caseStudy"].active {
    border-color: #d97706;
    background: rgba(245, 158, 11, 0.12);
}

.preset-item[data-preset="masterClass"].active {
    border-color: #dc2626;
    background: rgba(239, 68, 68, 0.12);
}
        
        .preset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .preset-title {
            font-weight: 700;
            color: #1f2937;
            font-size: 1.1rem;
        }
        
        .preset-hours {
            color: #7c3aed;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .preset-description {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 12px;
        }
        
        .preset-includes {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .preset-includes-title {
            font-weight: 600;
            color: #374151;
            font-size: 0.8rem;
            margin-bottom: 6px;
        }
        
        .preset-includes-list {
            color: #6b7280;
            font-size: 0.75rem;
            line-height: 1.3;
        }
        
        .preset-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .preset-quantity-label {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }
        
        .preset-quantity-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .component-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .component-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .component-item.selected {
            background: #ede9fe;
            border-color: #7c3aed;
        }
        
        .component-item.auto-selected {
            background: #ecfdf5;
            border-color: #10b981;
        }
        
        .component-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .component-header input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
        }
        
        .component-title {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        
        .component-hours {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .component-description {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.3;
            margin-left: 24px;
            margin-bottom: 10px;
        }
        
        .component-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 24px;
            margin-bottom: 8px;
            display: none;
        }
        
        .component-quantity.visible {
            display: flex;
        }
        
        .component-quantity-label {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .component-quantity-input {
            width: 80px;
            padding: 6px 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }
        
        .auto-selected-label {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 10px;
        }
        
        .service-item {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .service-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .service-item.selected {
            background: #ede9fe;
            border-color: #7c3aed;
        }
        
        .service-item.auto-selected {
            background: #ecfdf5;
            border-color: #10b981;
        }
        
        .service-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .service-header input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
        }
        
        .service-title {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        
        .service-hours {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .service-description {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.3;
            margin-left: 24px;
        }
        
        .quantity-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            margin-left: 24px;
            display: none;
        }
        
        .quantity-input-group.visible {
            display: flex;
        }
        
        .quantity-input-small {
            width: 80px;
            padding: 6px 8px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
        }
        
        .quantity-label-small {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .result-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .result-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #4f46e5;
            margin-right: 10px;
            border-radius: 2px;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 800;
            color: #4f46e5;
            margin-bottom: 5px;
        }
        
        .result-subtitle {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.05rem;
            color: #1f2937;
        }
        
        .breakdown-left {
            flex: 1;
        }
        
        .breakdown-right {
            font-weight: 600;
            color: #4f46e5;
        }
        
        .breakdown-section {
            margin-bottom: 15px;
        }
        
        .breakdown-section-title {
            font-weight: 600;
            color: #4f46e5;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .result-section {
                border-left: none;
                border-top: 1px solid #e5e7eb;
                position: static;
                max-height: none;
            }
            
            .form-section, .result-section {
                padding: 20px;
            }
            
            .preset-grid {
                grid-template-columns: 1fr;
            }
            
            .components-grid {
                grid-template-columns: 1fr;
            }
        }

        .preset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .preset-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

.preset-tag {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.7rem;
    font-weight: 500;
    margin-right: 4px;
    margin-bottom: 3px;
    border: 1px solid transparent;
}

.preset-tag.textLesson { 
    background: rgba(59, 130, 246, 0.15);
    color: #64748b;
    border-color: rgba(59, 130, 246, 0.25);
}

.preset-tag.videoLesson { 
    background: rgba(139, 92, 246, 0.15);
    color: #7c3aed;
    border-color: rgba(139, 92, 246, 0.25);
}

.preset-tag.webinar { 
    background: rgba(236, 72, 153, 0.15);
    color: #be185d;
    border-color: rgba(236, 72, 153, 0.25);
}

.preset-tag.workshop { 
    background: rgba(16, 185, 129, 0.15);
    color: #047857;
    border-color: rgba(16, 185, 129, 0.25);
}

.preset-tag.caseStudy { 
    background: rgba(245, 158, 11, 0.15);
    color: #d97706;
    border-color: rgba(245, 158, 11, 0.25);
}

.preset-tag.masterClass { 
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
    border-color: rgba(239, 68, 68, 0.25);
}

.copy-button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.copy-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
}

.copy-button:active {
    transform: translateY(0);
}

.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip-content {
    visibility: hidden;
    width: 200px;
    background-color: #1f2937;
    color: white;
    text-align: center;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.8rem;
    line-height: 1.3;
}

.tooltip-content::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #1f2937 transparent transparent transparent;
}

.tooltip.show .tooltip-content {
    visibility: visible;
    opacity: 1;
}

.slider-container {
    position: relative;
}

    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Калькулятор методических услуг 1.0</h1>
            <p>Гибкая система расчета с пресетами и детальной настройкой</p>
        </div>
        
        <div class="content">
            <div class="form-section">
                <div class="section-title">Базовые параметры</div>
                
                <div class="form-group">
                    <label for="hourlyRate">Ставка за час (₽):</label>
                    <input type="number" id="hourlyRate" value="220" min="100" max="5000">
                </div>
                
                <div class="slider-group">
                    <label for="lessonDuration">Средняя длительность урока (минуты):</label>
                    <input type="range" id="lessonDuration" min="0" max="120" step="5" value="30">
                    <div class="slider-value" id="lessonDurationValue">30 минут</div>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="simpleCalculation">
                        <label for="simpleCalculation">Упрощенный расчет (без коэффициентов)</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="methodistRole">Роль методиста:</label>
                    <select id="methodistRole">
                        <option value="1.0">Методист-автор (пишу контент сам)</option>
                        <option value="0.5">Методист-редактор (проверяю за автором)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="domainKnowledge">Знание предметной области:</label>
                    <select id="domainKnowledge">
                        <option value="1.0">Знаю домен хорошо</option>
                        <option value="1.3">Новый домен (требуется изучение)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="projectType">Характер работы:</label>
                    <select id="projectType">
                        <option value="1.0">Новая программа по моей методике</option>
                        <option value="1.2">Доработка существующих материалов</option>
                        <option value="1.4">Работа по чужой программе/методике</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="contentComplexity">Сложность контента:</label>
                    <select id="contentComplexity">
                        <option value="1.0">Простой - теория и понятия</option>
                        <option value="1.2" selected>Средний - теория + применение</option>
                        <option value="1.4">Сложный - теория + применение + инструменты</option>
                        <option value="1.6">Высокосложный - теория + применение + инструменты + кейсы</option>
                    </select>
                </div>

<div class="form-group">
    <label for="urgency">Срочность выполнения:</label>
    <select id="urgency">
        <option value="1.0">Обычная (без ограничений по времени)</option>
        <option value="1.2">Ускоренная (сжатые сроки) - +20%</option>
        <option value="1.5">Срочная (очень сжатые сроки) - +50%</option>
        <option value="2.0">Экстренная (критические сроки) - +100%</option>
    </select>
</div>

<div class="form-group">
    <label for="qualityLevel">Уровень качества:</label>
    <select id="qualityLevel">
        <option value="0.7">Базовый (экономия 30%)</option>
        <option value="1.0" selected>Стандарт</option>
        <option value="1.5">Премиум (+50%)</option>
    </select>
</div>
                
                <div class="section-title">Быстрые пресеты (по типам контента)</div>
                
                <div class="info-card">
                    <h4>Как работают пресеты</h4>
                    <p>Пресеты автоматически активируют компоненты с учетом средней длительности урока.</p>
                </div>

<div class="preset-grid">
                    <div class="preset-item" data-preset="textLesson">
                        <div class="preset-header">
                            <div class="preset-title">Текстовый урок</div>
                            <div class="preset-hours" id="textLessonPrice">1 210 ₽/шт</div>
                        </div>
                        <div class="preset-description">Статья для самостоятельного изучения теории и концепций (20-40 мин чтения)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Автоматически активирует:</div>
                            <div class="preset-includes-list">Лонгрид + Упражнения + Иллюстрации + Квизы</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="textLessonPreset" value="0" min="0" max="50">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="textLessonDuration" value="30" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="videoLesson">
                        <div class="preset-header">
                            <div class="preset-title">Видео урок</div>
                            <div class="preset-hours" id="videoLessonPrice">1 760 ₽/шт</div>
                        </div>
                        <div class="preset-description">Видеоурок с презентацией для объяснения процессов и демонстрации (30-90 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Автоматически активирует:</div>
                            <div class="preset-includes-list">Скрипт + Презентация + Иллюстрации</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="videoLessonPreset" value="0" min="0" max="50">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="videoLessonDuration" value="60" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="webinar">
                        <div class="preset-header">
                            <div class="preset-title">Вебинар</div>
                            <div class="preset-hours" id="webinarPrice">1 540 ₽/шт</div>
                        </div>
                        <div class="preset-description">Живое онлайн-обучение с интерактивным взаимодействием с аудиторией (60-120 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Автоматически активирует:</div>
                            <div class="preset-includes-list">Презентация + Иллюстрации + Механики вовлечения</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="webinarPreset" value="0" min="0" max="20">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="webinarDuration" value="90" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="workshop">
                        <div class="preset-header">
                            <div class="preset-title">Практикум</div>
                            <div class="preset-hours" id="workshopPrice">1 980 ₽/шт</div>
                        </div>
                        <div class="preset-description">Воркшоп для отработки навыков с пошаговыми инструкциями (60-180 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Автоматически активирует:</div>
                            <div class="preset-includes-list">Инструкции + Шаблоны + Упражнения + Примеры</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="workshopPreset" value="0" min="0" max="20">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="workshopDuration" value="60" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="caseStudy">
                        <div class="preset-header">
                            <div class="preset-title">Кейс-стади</div>
                          <div class="preset-hours" id="caseStudyPrice">1 100 ₽/шт</div>
                        </div>
                        <div class="preset-description">Разбор реальной ситуации для анализа и обсуждения решений (30-60 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Автоматически активирует:</div>
                            <div class="preset-includes-list">Описание кейса + Вопросы + Разбор решения</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="caseStudyPreset" value="0" min="0" max="20">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="caseStudyDuration" value="45" min="0" max="120">
                        </div>
                    </div>
                    
                    <div class="preset-item" data-preset="masterClass">
                        <div class="preset-header">
                            <span class="preset-title">Мастер-класс</span>
                            <div class="preset-hours" id="masterClassPrice">1 540 ₽/шт</div>
                        </div>
                        <div class="preset-description">Демонстрация экспертного подхода на конкретном примере (45-90 мин)</div>
                        <div class="preset-includes">
                            <div class="preset-includes-title">Автоматически активирует:</div>
                            <div class="preset-includes-list">Разбор кейса + Вопросы для анализа + Разбор решения</div>
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Количество:</span>
                            <input type="number" class="preset-quantity-input" id="masterClassPreset" value="0" min="0" max="50">
                        </div>
                        <div class="preset-quantity">
                            <span class="preset-quantity-label">Средняя длительность (мин):</span>
                            <input type="number" class="preset-quantity-input" id="masterClassDuration" value="60" min="10" max="240">
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Компоненты образовательного контента</div>
                
                <div class="info-card">
                    <h4>Детальная настройка</h4>
                    <p><span style="color: #10b981;">●</span> Зеленые - активированы пресетом, можно отключить<br>
                    <span style="color: #7c3aed;">●</span> Фиолетовые - выбраны дополнительно</p>
                </div>
              
              <div class="components-grid">
                    <div class="component-item" data-component="longread">
                        <div class="component-header">
                            <input type="checkbox" id="longread">
                            <span class="component-title">Лонгрид</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="longreadHoursDisplay">2.5ч/шт</span>
    <span class="component-price" id="longreadPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">550 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Структурированная статья урока объемом 1500-2000 знаков для самостоятельного изучения</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                        </div>
                        <div class="component-quantity" id="longreadQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="longreadHours" value="2.5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="longreadCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="longreadCount" value="1" min="1" max="50">
                        </div>
                        <div class="component-quantity" id="longreadPagesGroup">
                            <span class="component-quantity-label">Листы А4:</span>
                            <input type="number" class="component-quantity-input" id="longreadPages" value="1" min="0.5" max="10" step="0.5">
                        </div>
                    </div>

                    <div class="component-item" data-component="script">
                        <div class="component-header">
                            <input type="checkbox" id="script">
                            <span class="component-title">Скрипт для записи</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="scriptHoursDisplay">4ч/шт</span>
    <span class="component-price" id="scriptPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">880 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Готовый текст с разметкой и комментариями для записи видеоурока длительностью 30-90 минут</div>
                        <div class="preset-tags">
                            <span class="preset-tag videoLesson">Видео уроки</span>
                        </div>
                        <div class="component-quantity" id="scriptQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="scriptHours" value="4" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="scriptCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="scriptCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="presentation">
                        <div class="component-header">
                            <input type="checkbox" id="presentation">
                            <span class="component-title">Презентация</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="presentationHoursDisplay">6ч/шт</span>
    <span class="component-price" id="presentationPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">1 320 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Слайд-дека из 15-25 слайдов с текстом и структурой для урока или вебинара</div>
                        <div class="preset-tags">
                            <span class="preset-tag videoLesson">Видео уроки</span>
                            <span class="preset-tag webinar">Вебинары</span>
                        </div>
                        <div class="component-quantity" id="presentationQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="presentationHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="presentationCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="presentationCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="exercises">
                        <div class="component-header">
                            <input type="checkbox" id="exercises">
                            <span class="component-title">Упражнения</span>
                           <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="exercisesHoursDisplay">1ч/шт</span>
    <span class="component-price" id="exercisesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">220 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Практические задания на отработку навыков внутри урока с инструкциями и примерами</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="exercisesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="exercisesHours" value="1" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="exercisesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="exercisesCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="illustrations">
                        <div class="component-header">
                            <input type="checkbox" id="illustrations">
                            <span class="component-title">Иллюстрации</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="illustrationsHoursDisplay">0.5ч/шт</span>
    <span class="component-price" id="illustrationsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">110 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Подбор и адаптация 5-10 визуальных материалов для поддержки контента урока</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                            <span class="preset-tag videoLesson">Видео уроки</span>
                            <span class="preset-tag webinar">Вебинары</span>
                        </div>
                        <div class="component-quantity" id="illustrationsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="illustrationsHours" value="0.5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="illustrationsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="illustrationsCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="quizzes">
                        <div class="component-header">
                            <input type="checkbox" id="quizzes">
                            <span class="component-title">Квизы</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="quizzesHoursDisplay">1.5ч/шт</span>
    <span class="component-price" id="quizzesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">330 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Интерактивная проверка из 5-10 вопросов для закрепления материала урока</div>
                        <div class="preset-tags">
                            <span class="preset-tag textLesson">Текстовые уроки</span>
                        </div>
                        <div class="component-quantity" id="quizzesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="quizzesHours" value="1.5" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="quizzesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="quizzesCount" value="1" min="1" max="50">
                        </div>
                        <div class="component-quantity" id="quizzesQuestionsGroup">
                            <span class="component-quantity-label">Вопросов:</span>
                            <input type="number" class="component-quantity-input" id="quizzesQuestions" value="7" min="1" max="20">
                        </div>
                    </div>
                
                	<div class="component-item" data-component="instructions">
                        <div class="component-header">
                            <input type="checkbox" id="instructions">
                            <span class="component-title">Пошаговые инструкции</span>
                           <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="instructionsHoursDisplay">3ч/шт</span>
    <span class="component-price" id="instructionsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">660 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Детальный алгоритм действий с пошаговым разбором для самостоятельного выполнения</div>
                        <div class="preset-tags">
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="instructionsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="instructionsHours" value="3" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="instructionsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="instructionsCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="templates">
                        <div class="component-header">
                            <input type="checkbox" id="templates">
                            <span class="component-title">Шаблоны/Канвасы</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="templatesHoursDisplay">2ч/шт</span>
    <span class="component-price" id="templatesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">440 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Готовые бланки и формы для заполнения участниками во время практических занятий</div>
                        <div class="preset-tags">
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="templatesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="templatesHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="templatesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="templatesCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="examples">
                        <div class="component-header">
                            <input type="checkbox" id="examples">
                            <span class="component-title">Разбор примера</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="examplesHoursDisplay">2ч/шт</span>
    <span class="component-price" id="examplesPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">440 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Детальный анализ реального или учебного кейса с объяснением решений и выводов</div>
                        <div class="preset-tags">
                            <span class="preset-tag workshop">Практикумы</span>
                        </div>
                        <div class="component-quantity" id="examplesQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="examplesHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="examplesCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="examplesCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="caseDescription">
                        <div class="component-header">
                            <input type="checkbox" id="caseDescription">
                            <span class="component-title">Разбор кейса</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="caseDescriptionHoursDisplay">3ч/шт</span>
    <span class="component-price" id="caseDescriptionPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">660 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Структурированное описание ситуации с контекстом и данными для анализа участниками</div>
                        <div class="preset-tags">
                            <span class="preset-tag caseStudy">Кейс-стади</span>
                            <span class="preset-tag masterClass">Мастер-классы</span>
                        </div>
                        <div class="component-quantity" id="caseDescriptionQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="caseDescriptionHours" value="3" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="caseDescriptionCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="caseDescriptionCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="caseQuestions">
                        <div class="component-header">
                            <input type="checkbox" id="caseQuestions">
                            <span class="component-title">Вопросы для анализа</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="caseQuestionsHoursDisplay">1ч/шт</span>
    <span class="component-price" id="caseQuestionsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">220 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Набор из 5-8 направляющих вопросов для самостоятельного разбора кейса участниками</div>
                        <div class="preset-tags">
                            <span class="preset-tag caseStudy">Кейс-стади</span>
                            <span class="preset-tag masterClass">Мастер-классы</span>
                        </div>
                        <div class="component-quantity" id="caseQuestionsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="caseQuestionsHours" value="1" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="caseQuestionsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="caseQuestionsCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="caseSolution">
                        <div class="component-header">
                            <input type="checkbox" id="caseSolution">
                            <span class="component-title">Разбор решения</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="caseSolutionHoursDisplay">1ч/шт</span>
    <span class="component-price" id="caseSolutionPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">220 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Экспертный комментарий с объяснением правильного решения кейса и альтернативных вариантов</div>
                        <div class="preset-tags">
                            <span class="preset-tag caseStudy">Кейс-стади</span>
                            <span class="preset-tag masterClass">Мастер-классы</span>
                        </div>
                        <div class="component-quantity" id="caseSolutionQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="caseSolutionHours" value="1" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="caseSolutionCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="caseSolutionCount" value="1" min="1" max="50">
                        </div>
                    </div>

                    <div class="component-item" data-component="engagementMechanics">
                        <div class="component-header">
                            <input type="checkbox" id="engagementMechanics">
                            <span class="component-title">Механики вовлечения</span>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
    <span class="component-hours" id="engagementMechanicsHoursDisplay">2ч/шт</span>
    <span class="component-price" id="engagementMechanicsPrice" style="font-size: 0.8rem; color: #7c3aed; font-weight: 600;">440 ₽/шт</span>
</div>
                        </div>
                        <div class="component-description">Интерактивные элементы для удержания внимания: опросы, чаты, голосования, мини-игры</div>
                        <div class="preset-tags">
                            <span class="preset-tag webinar">Вебинары</span>
                        </div>
                        <div class="component-quantity" id="engagementMechanicsQuantity">
                            <span class="component-quantity-label">Среднее время разработки (ч):</span>
                            <input type="number" class="component-quantity-input" id="engagementMechanicsHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="component-quantity" id="engagementMechanicsCountGroup">
                            <span class="component-quantity-label">Количество:</span>
                            <input type="number" class="component-quantity-input" id="engagementMechanicsCount" value="1" min="1" max="50">
                        </div>
                    </div>
                </div>

				<div class="section-title">Система проверки знаний</div>
                
                <div class="service-grid">
                    <div class="service-item" data-service="currentTests">
                        <div class="service-header">
                            <input type="checkbox" id="currentTests">
                            <span class="service-title">Текущая проверка</span>
                            <span class="service-hours" id="currentTestsHoursDisplay">2ч/шт</span>
                        </div>
                        <div class="service-description">Тесты и домашние задания на 10-15 вопросов для закрепления материала каждого урока</div>
                        <div class="quantity-input-group" id="currentTestsHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="currentTestsHours" value="2" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="quantity-input-group" id="currentTestsCountGroup">
                            <span class="quantity-label-small">Количество:</span>
                            <input type="number" class="quantity-input-small" id="currentTestsCount" value="1" min="1" max="30">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="moduleProjects">
                        <div class="service-header">
                            <input type="checkbox" id="moduleProjects">
                            <span class="service-title">Промежуточная проверка</span>
                            <span class="service-hours" id="moduleProjectsHoursDisplay">4ч/шт</span>
                        </div>
                        <div class="service-description">Практические проекты и кейсы для проверки навыков в конце модуля или блока уроков</div>
                        <div class="quantity-input-group" id="moduleProjectsHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="moduleProjectsHours" value="4" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="quantity-input-group" id="moduleProjectsCountGroup">
                            <span class="quantity-label-small">Количество:</span>
                            <input type="number" class="quantity-input-small" id="moduleProjectsCount" value="1" min="1" max="10">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="finalAssessment">
                        <div class="service-header">
                            <input type="checkbox" id="finalAssessment">
                            <span class="service-title">Итоговая проверка</span>
                            <span class="service-hours" id="finalAssessmentHoursDisplay">6ч/шт</span>
                        </div>
                        <div class="service-description">Комплексная аттестация знаний и навыков в конце программы обучения с оценкой результатов</div>
                        <div class="quantity-input-group" id="finalAssessmentHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="finalAssessmentHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                        <div class="quantity-input-group" id="finalAssessmentCountGroup">
                            <span class="quantity-label-small">Количество:</span>
                            <input type="number" class="quantity-input-small" id="finalAssessmentCount" value="1" min="1" max="5">
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Дополнительные услуги</div>
                
                <div class="service-grid">
                    <div class="service-item" data-service="research">
                        <div class="service-header">
                            <input type="checkbox" id="research">
                            <span class="service-title">Кабинетное исследование</span>
                            <span class="service-hours" id="researchHoursDisplay">6ч</span>
                        </div>
                       <div class="service-description">Изучение предметной области, анализ конкурентов и лучших практик для создания актуального контента</div>
                        <div class="quantity-input-group" id="researchHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="researchHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="audit">
                        <div class="service-header">
                            <input type="checkbox" id="audit">
                            <span class="service-title">Методический аудит</span>
                            <span class="service-hours" id="auditHoursDisplay">6ч</span>
                        </div>
                        <div class="service-description">Экспертная оценка существующих материалов с рекомендациями по улучшению структуры и качества</div>
                        <div class="quantity-input-group" id="auditHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="auditHours" value="6" min="0.1" max="20" step="0.1">
                        </div>
                    </div>
                    
                    <div class="service-item" data-service="methodology">
                        <div class="service-header">
                            <input type="checkbox" id="methodology">
                            <span class="service-title">Методические артефакты</span>
                            <span class="service-hours" id="methodologyHoursDisplay">5ч</span>
                        </div>
                        <div class="service-description">Карта образовательных результатов и детальный тематический план программы обучения</div>
                        <div class="quantity-input-group" id="methodologyHoursGroup">
                            <span class="quantity-label-small">Среднее время разработки (ч):</span>
                            <input type="number" class="quantity-input-small" id="methodologyHours" value="5" min="0.1" max="20" step="0.1">
                        </div>
                    </div>

                    <div class="service-item" data-service="speakerPrep">
                        <div class="service-header">
                            <input type="checkbox" id="speakerPrep">
                            <span class="service-title">Подготовка спикера к записи урока</span>
                            <span class="service-hours" id="speakerPrepHoursDisplay">4ч</span>
                        </div>
                        <div class="service-description">Тренировка подачи материала, работа с речью и подготовка к качественной записи контента</div>
                        <div class="quantity-input-group" id="speakerPrepHoursGroup">
                            <span class="quantity-label-small">Общее время на подготовку (ч):</span>
                            <input type="number" class="quantity-input-small" id="speakerPrepHours" value="4" min="0.1" max="20" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Правки и итерации</div>
                
                <div class="form-group">
                    <label for="clientType">Тип заказчика:</label>
                    <select id="clientType">
                        <option value="10">Постоянный заказчик (знаю стиль) - 10%</option>
                        <option value="20" selected>Новый заказчик (притирка) - 20%</option>
                        <option value="0">Без правок - 0%</option>
                    </select>
                </div>
                
                <div class="info-card">
                    <h4>Важно: правки касаются только контента</h4>
                    <p>Правки применяются к компонентам образовательного контента и проверкам знаний. Дополнительные услуги не подлежат правкам.</p>
                </div>

<div class="section-title">Финансовые настройки</div>

<div class="slider-group">
    <label for="discountRate">Скидка/Наценка (%):</label>
    <div class="slider-container">
        <div class="tooltip" id="discountTooltip">
            <input type="range" id="discountRate" min="-50" max="50" step="5" value="0">
            <div class="tooltip-content" id="discountTooltipContent">
                Без изменений
            </div>
        </div>
    </div>
    <div class="slider-value" id="discountRateValue">0% (без изменений)</div>
</div>

<div class="slider-group">
    <label for="taxRate">Налоговая ставка (%):</label>
    <div class="slider-container">
        <div class="tooltip" id="taxTooltip">
            <input type="range" id="taxRate" min="0" max="30" step="1" value="13">
            <div class="tooltip-content" id="taxTooltipContent">
                НДФЛ для физлиц
            </div>
        </div>
    </div>
    <div class="slider-value" id="taxRateValue">13% (НДФЛ)</div>
</div>

<div class="form-group">
    <div class="checkbox-group">
        <input type="checkbox" id="showTaxSeparately" checked>
        <label for="showTaxSeparately">Показывать налог отдельной строкой</label>
    </div>
</div>
            </div>
            
            <div class="result-section">
                <div class="result-card">
                    <div class="result-title">Итоговая стоимость</div>
                    <div class="result-value" id="totalCost">0 ₽</div>
                    <div class="result-subtitle">За весь проект</div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Общее время</div>
                    <div class="result-value" id="totalHours">0 ч</div>
                    <div class="result-subtitle">Трудозатраты</div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Состав проекта</div>
                    <div id="projectComposition">
                        <div style="color: #6b7280; font-style: italic;">Выберите компоненты или используйте пресеты</div>
                    </div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">Детализация</div>
                    <div id="breakdown">
                        <div style="color: #6b7280; font-style: italic;">Расчет появится после выбора компонентов</div>
                    </div>
                </div>

<div class="result-card">
    <div class="result-title">Для клиента</div>
    <button class="copy-button" onclick="copyCalculationToClipboard()">
        Копировать расчет
    </button>
    <div class="copy-status" id="copyStatus" style="margin-top: 10px; color: #10b981; font-size: 0.9rem; display: none;">
        ✓ Скопировано в буфер обмена
    </div>
</div>

	<script>
    // Конфигурация пресетов
    const presets = {
        textLesson: {
            name: 'Текстовые уроки',
            components: ['longread', 'exercises', 'illustrations', 'quizzes'],
            baseHours: 5.5,
            defaultDuration: 30
        },
        videoLesson: {
            name: 'Видео уроки',
            components: ['script', 'presentation', 'illustrations'],
            baseHours: 8,
            defaultDuration: 60
        },
        webinar: {
            name: 'Вебинары',
            components: ['presentation', 'illustrations', 'engagementMechanics'],
            baseHours: 7,
            defaultDuration: 90
        },
        workshop: {
            name: 'Практикумы',
            components: ['instructions', 'templates', 'exercises', 'examples'],
            baseHours: 9,
            defaultDuration: 60
        },
        caseStudy: {
            name: 'Кейс-стади',
            components: ['caseDescription', 'caseQuestions', 'caseSolution'],
            baseHours: 5,
            defaultDuration: 45
        },
        masterClass: {
            name: 'Мастер-классы',
            components: ['caseDescription', 'caseQuestions', 'caseSolution'],
            baseHours: 7,
            defaultDuration: 60
        }
    };

    // Конфигурация компонентов
    const components = {
        longread: { 
            defaultHours: 2.5, 
            name: 'Лонгрид', 
            description: 'Структурированный текстовый материал урока из расчета 1 лист А4 машинописного текста', 
            presets: ['textLesson'] 
        },
        script: { 
            defaultHours: 4, 
            name: 'Скрипт для записи', 
            description: 'Текст для самостоятельной видеозаписи урока с разметкой комментариев', 
            presets: ['videoLesson'] 
        },
        presentation: { 
            defaultHours: 6, 
            name: 'Презентация', 
            description: 'Слайды для урока или вебинара без учета подбора иллюстраций', 
            presets: ['videoLesson', 'webinar'] 
        },
        exercises: { 
            defaultHours: 1, 
            name: 'Упражнения', 
            description: 'Практические задания внутри урока', 
            presets: ['textLesson', 'workshop'] 
        },
        illustrations: { 
            defaultHours: 0.5, 
            name: 'Иллюстрации', 
            description: 'Поиск и упаковка визуальных материалов для уроков', 
            presets: ['textLesson', 'videoLesson', 'webinar'] 
        },
        quizzes: { 
            defaultHours: 1.5, 
            name: 'Квизы', 
            description: 'Интерактивные элементы для повышения вовлеченности', 
            presets: ['textLesson'] 
        },
        instructions: { 
            defaultHours: 3, 
            name: 'Пошаговые инструкции', 
            description: 'Детальные руководства к действию/применению для отдельного изучения', 
            presets: ['workshop'] 
        },
        templates: {
            defaultHours: 2, 
            name: 'Шаблоны/Канвасы', 
            description: 'Подбор, адаптация или разработка новых форм для заполнения', 
            presets: ['workshop'] 
        },
        examples: { 
            defaultHours: 2, 
            name: 'Разбор примера', 
            description: 'Разработка и описание детального анализа практических и гипотетических случаев', 
            presets: ['workshop'] 
        },
        caseDescription: { 
            defaultHours: 3, 
            name: 'Разбор кейса', 
            description: 'Разработка и описание структурированно изложенной ситуации', 
            presets: ['caseStudy', 'masterClass'] 
        },
        caseQuestions: { 
            defaultHours: 1, 
            name: 'Вопросы для анализа', 
            description: 'Формирование пакета вопросов для готового кейса', 
            presets: ['caseStudy', 'masterClass'] 
        },
        caseSolution: { 
            defaultHours: 1, 
            name: 'Разбор решения', 
            description: 'Упаковка экспертного комментария или решения кейса в обучающий формат', 
            presets: ['caseStudy', 'masterClass'] 
        },
        engagementMechanics: { 
            defaultHours: 2, 
            name: 'Механики вовлечения', 
            description: 'Подбор, адаптация и разработка интерактивных элементов для удержания внимания', 
            presets: ['webinar'] 
        }
    };

    // Конфигурация проверок знаний
    const assessments = {
        currentTests: { defaultHours: 2, name: 'Текущая проверка' },
        moduleProjects: { defaultHours: 4, name: 'Промежуточная проверка' },
        finalAssessment: { defaultHours: 6, name: 'Итоговая проверка' }
    };

    // Конфигурация дополнительных услуг
    const services = {
        research: { defaultHours: 6, name: 'Кабинетное исследование' },
        audit: { defaultHours: 6, name: 'Методический аудит' },
        methodology: { defaultHours: 5, name: 'Методические артефакты' },
        speakerPrep: { defaultHours: 4, name: 'Подготовка спикера к записи урока' }
    };

// Система весов для коэффициентов
const influenceWeights = {
    domain: 0.6,        // Изучение нового домена
    project: 0.8,       // Тип проекта/методики
    complexity: 1.0,    // Сложность контента (базовая)
    urgency: 0.5        // Срочность выполнения
};

// Нормализация весов
const totalInfluence = Object.values(influenceWeights).reduce((sum, weight) => sum + weight, 0);
const normalizedWeights = {};
Object.keys(influenceWeights).forEach(key => {
    normalizedWeights[key] = influenceWeights[key] / totalInfluence;
});

// Функция обновления цен в пресетах
function updatePresetPrices() {
    const hourlyRate = safeGetValue('hourlyRate', 220);
    const simpleCalculation = safeGetElement('simpleCalculation')?.checked || false;
    const methodistRole = simpleCalculation ? 1.0 : safeGetValue('methodistRole', 1.0);
    const domainKnowledge = simpleCalculation ? 1.0 : safeGetValue('domainKnowledge', 1.0);
    const projectType = simpleCalculation ? 1.0 : safeGetValue('projectType', 1.0);
    const contentComplexity = simpleCalculation ? 1.0 : safeGetValue('contentComplexity', 1.2);
    const urgency = simpleCalculation ? 1.0 : safeGetValue('urgency', 1.0);
    const qualityLevel = simpleCalculation ? 1.0 : safeGetValue('qualityLevel', 1.0);
    
    const complexityMultiplier = simpleCalculation ? 1.0 : calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
    
    Object.keys(presets).forEach(presetType => {
        const count = parseInt(safeGetValue(presetType + 'Preset', 1));
        const presetDuration = parseInt(safeGetValue(presetType + 'Duration', presets[presetType].defaultDuration));
        const durationFactor = presetDuration / presets[presetType].defaultDuration;
        
        let baseHours = 0;
        presets[presetType].components.forEach(componentId => {
            const hours = safeGetValue(componentId + 'Hours', components[componentId]?.defaultHours || 1);
            baseHours += hours;
        });
        
        const volumeDiscount = getVolumeDiscount(count);
        const adjustedHours = baseHours * durationFactor * complexityMultiplier * qualityLevel * volumeDiscount;
        const pricePerUnit = Math.round(adjustedHours * hourlyRate);
        
        const priceElement = safeGetElement(presetType + 'Price');
        if (priceElement) {
            priceElement.textContent = pricePerUnit.toLocaleString('ru-RU') + ' ₽/шт';
        }
    });
}

// Функция обновления цен компонентов
function updateComponentPrices() {
    const hourlyRate = safeGetValue('hourlyRate', 220);
    const lessonDuration = parseInt(safeGetValue('lessonDuration', 30));
    const simpleCalculation = safeGetElement('simpleCalculation')?.checked || false;
    const methodistRole = simpleCalculation ? 1.0 : safeGetValue('methodistRole', 1.0);
    const domainKnowledge = simpleCalculation ? 1.0 : safeGetValue('domainKnowledge', 1.0);
    const projectType = simpleCalculation ? 1.0 : safeGetValue('projectType', 1.0);
    const contentComplexity = simpleCalculation ? 1.0 : safeGetValue('contentComplexity', 1.2);
    const urgency = simpleCalculation ? 1.0 : safeGetValue('urgency', 1.0);
    const qualityLevel = simpleCalculation ? 1.0 : safeGetValue('qualityLevel', 1.0);
    
    const complexityMultiplier = simpleCalculation ? 1.0 : calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
    
    Object.keys(components).forEach(componentId => {
        const baseHours = safeGetValue(componentId + 'Hours', components[componentId]?.defaultHours || 1);
        
        let volumeFactor = 1.0;
        if (componentId === 'longread') {
            const pages = safeGetValue('longreadPages', 1);
            volumeFactor = pages;
        } else if (componentId === 'quizzes') {
            const questions = parseInt(safeGetValue('quizzesQuestions', 7));
            volumeFactor = questions / 7;
        }
        
        const adjustedHours = baseHours * volumeFactor * (lessonDuration / 60) * complexityMultiplier * qualityLevel;
        const pricePerUnit = Math.round(adjustedHours * hourlyRate);
        
        const priceElement = safeGetElement(componentId + 'Price');
        if (priceElement) {
            priceElement.textContent = pricePerUnit.toLocaleString('ru-RU') + ' ₽/шт';
        }
    });
}

// Функция расчета скидки за объем
function getVolumeDiscount(quantity) {
    if (quantity <= 5) return 1.0;
    if (quantity <= 15) return 0.9;
    if (quantity <= 30) return 0.8;
    return 0.7;
}

// Функция расчета адаптивного коэффициента
function calculateAdaptiveMultiplier(domain, project, complexity, urgency, role) {
    // Взвешенная сумма коэффициентов
    const weightedSum = 1.0 + 
        (domain - 1) * normalizedWeights.domain +
        (project - 1) * normalizedWeights.project +
        (complexity - 1) * normalizedWeights.complexity +
        (urgency - 1) * normalizedWeights.urgency;
    
    // Применяем роль методиста отдельно
    let result = weightedSum * role;
    
    // Адаптивное ограничение для экстремальных случаев
    if (result > 2.5) {
        result = 2.5 + (result - 2.5) * 0.5;
    }
    if (result > 4.0) {
        result = 4.0; // Абсолютный максимум
    }
    
    return result;
}

    // Отслеживание автоматически активированных компонентов и услуг
    let autoActivatedComponents = new Set();
    let autoActivatedServices = new Set();

// Функции для работы с финансовыми настройками и подсказками
function updateDiscountDisplay() {
    const discountRate = parseInt(safeGetValue('discountRate', 0));
    const discountRateValue = safeGetElement('discountRateValue');
    const tooltip = safeGetElement('discountTooltipContent');
    
    if (discountRateValue) {
        if (discountRate === 0) {
            discountRateValue.textContent = '0% (без изменений)';
        } else if (discountRate > 0) {
            discountRateValue.textContent = `+${discountRate}% (наценка)`;
        } else {
            discountRateValue.textContent = `${discountRate}% (скидка)`;
        }
    }
    
    if (tooltip) {
        if (discountRate === 0) {
            tooltip.textContent = 'Без изменений';
        } else if (discountRate === -10) {
            tooltip.textContent = 'Постоянный клиент';
        } else if (discountRate === -15) {
            tooltip.textContent = 'Хорошие партнеры';
        } else if (discountRate === -20) {
            tooltip.textContent = 'Внутренний проект';
        } else if (discountRate > 0) {
            tooltip.textContent = 'Наценка за сложности';
        } else {
            tooltip.textContent = 'Индивидуальная скидка';
        }
    }
}

function updateTaxDisplay() {
    const taxRate = parseInt(safeGetValue('taxRate', 13));
    const taxRateValue = safeGetElement('taxRateValue');
    const tooltip = safeGetElement('taxTooltipContent');
    
    if (taxRateValue) {
        if (taxRate === 0) {
            taxRateValue.textContent = '0% (без налогов)';
        } else {
            taxRateValue.textContent = `${taxRate}%`;
        }
    }
    
    if (tooltip) {
        if (taxRate === 0) {
            tooltip.textContent = 'Самозанятый без налогов';
        } else if (taxRate === 4) {
            tooltip.textContent = 'Самозанятый с налогом';
        } else if (taxRate === 6) {
            tooltip.textContent = 'УСН доходы';
        } else if (taxRate === 13) {
            tooltip.textContent = 'НДФЛ для физлиц';
        } else if (taxRate === 15) {
            tooltip.textContent = 'УСН доходы-расходы';
        } else if (taxRate === 20) {
            tooltip.textContent = 'НДС + налог на прибыль';
        } else {
            tooltip.textContent = 'Индивидуальная ставка';
        }
    }
}

function showTooltip(tooltipId) {
    const tooltip = safeGetElement(tooltipId);
    if (tooltip) {
        tooltip.classList.add('show');
    }
}

function hideTooltip(tooltipId) {
    const tooltip = safeGetElement(tooltipId);
    if (tooltip) {
        tooltip.classList.remove('show');
    }
}

	// Функция для безопасного получения элемента
    function safeGetElement(id) {
        const element = document.getElementById(id);
        if (!element) {
            console.warn('Element not found:', id);
        }
        return element;
    }

    // Функция для безопасного получения значения
    function safeGetValue(id, defaultValue = 0) {
        const element = safeGetElement(id);
        if (!element) return defaultValue;
        
        const value = parseFloat(element.value);
        return isNaN(value) ? defaultValue : value;
    }

    // Обновление отображения длительности урока
    function updateLessonDurationDisplay() {
        const lessonDurationInput = safeGetElement('lessonDuration');
        const lessonDurationValue = safeGetElement('lessonDurationValue');
        
        if (lessonDurationInput && lessonDurationValue) {
            lessonDurationValue.textContent = lessonDurationInput.value + ' минут';
        }
    }

    // Автоматическая активация услуг
    function handleAutoActivation() {
        const domainKnowledge = safeGetValue('domainKnowledge', 1.0);
        const projectType = safeGetValue('projectType', 1.0);

        // Новый домен -> активировать исследование и методические артефакты
        if (domainKnowledge === 1.3) {
            activateService('research', true);
            activateService('methodology', true);
        } else {
            deactivateService('research');
            if (projectType !== 1.0) {
                deactivateService('methodology');
            }
        }

        // Новая программа -> активировать методические артефакты
        if (projectType === 1.0) {
            activateService('methodology', true);
        } else if (domainKnowledge !== 1.3) {
            deactivateService('methodology');
        }

        calculateCost();
    }

    function activateService(serviceId, isAuto) {
        const checkbox = safeGetElement(serviceId);
        if (!checkbox) return;
        
        const element = checkbox.closest('.service-item');
        if (!element) return;
        
        const quantityGroups = element.querySelectorAll('.quantity-input-group');

        if (!checkbox.checked) {
            checkbox.checked = true;
            if (isAuto) {
                element.classList.add('auto-selected');
                element.classList.remove('selected');
                autoActivatedServices.add(serviceId);
                updateAutoLabel(element, true);
            } else {
                element.classList.add('selected');
                element.classList.remove('auto-selected');
            }
            quantityGroups.forEach(group => group.classList.add('visible'));
        }
    }

    function deactivateService(serviceId) {
        if (!autoActivatedServices.has(serviceId)) return;
        
        const checkbox = safeGetElement(serviceId);
        if (!checkbox) return;
        
        const element = checkbox.closest('.service-item');
        if (!element) return;
        
        const quantityGroups = element.querySelectorAll('.quantity-input-group');

        checkbox.checked = false;
        element.classList.remove('auto-selected', 'selected');
        autoActivatedServices.delete(serviceId);
        updateAutoLabel(element, false);
        quantityGroups.forEach(group => group.classList.remove('visible'));
    }

    function updateAutoLabel(element, isAuto) {
        const title = element.querySelector('.component-title') || element.querySelector('.service-title');
        if (!title) return;
        
        let label = title.querySelector('.auto-selected-label');

        if (isAuto && !label) {
            label = document.createElement('span');
            label.className = 'auto-selected-label';
            label.textContent = 'АВТО';
            title.appendChild(label);
        } else if (!isAuto && label) {
            label.remove();
        }
    }

    function showComponentQuantities(componentId, show) {
        const quantities = document.querySelectorAll('#' + componentId + 'Quantity, #' + componentId + 'CountGroup, #' + componentId + 'PagesGroup, #' + componentId + 'QuestionsGroup');
        quantities.forEach(qty => {
            if (show) {
                qty.classList.add('visible');
            } else {
                qty.classList.remove('visible');
            }
        });
    }

    function showServiceQuantities(serviceId, show) {
        const groups = document.querySelectorAll('#' + serviceId + 'HoursGroup, #' + serviceId + 'CountGroup');
        groups.forEach(group => {
            if (show) {
                group.classList.add('visible');
            } else {
                group.classList.remove('visible');
            }
        });
    }

	function applyPreset(presetType) {
        const preset = presets[presetType];
        if (!preset) return;
        
        const count = parseInt(safeGetValue(presetType + 'Preset', 0));
        const presetElement = document.querySelector('[data-preset="' + presetType + '"]');

        if (count > 0) {
            preset.components.forEach(componentId => {
                const checkbox = safeGetElement(componentId);
                if (!checkbox) return;
                
                const element = checkbox.closest('.component-item');
                if (!element) return;
                
                const countInput = safeGetElement(componentId + 'Count');

                if (!checkbox.checked) {
                    checkbox.checked = true;
                    element.classList.add('auto-selected');
                    element.classList.remove('selected');
                    autoActivatedComponents.add(componentId);
                    showComponentQuantities(componentId, true);

                    if (countInput) {
                        countInput.value = count;
                    }

                    // Специальные настройки для текстовых уроков
                    if (presetType === 'textLesson') {
                        if (componentId === 'longread') {
                            const pagesInput = safeGetElement('longreadPages');
                            if (pagesInput) pagesInput.value = 1;
                        } else if (componentId === 'quizzes') {
                            const questionsInput = safeGetElement('quizzesQuestions');
                            if (questionsInput) questionsInput.value = 7;
                        }
                    }

                    updateAutoLabel(element, true);
                } else if (autoActivatedComponents.has(componentId)) {
                    if (countInput) {
                        countInput.value = Math.max(parseInt(countInput.value) || 0, count);
                    }
                }
            });

            if (presetElement) {
                presetElement.classList.add('active');
            }
        } else {
            if (presetElement) {
                presetElement.classList.remove('active');
            }

            preset.components.forEach(componentId => {
                if (!autoActivatedComponents.has(componentId)) return;
                
                const checkbox = safeGetElement(componentId);
                if (!checkbox) return;
                
                const element = checkbox.closest('.component-item');
                if (!element) return;

                // Проверяем, нужен ли компонент другим активным пресетам
                const neededByOtherPresets = Object.keys(presets).some(otherPreset => {
                    if (otherPreset === presetType) return false;
                    const otherCount = parseInt(safeGetValue(otherPreset + 'Preset', 0));
                    return otherCount > 0 && presets[otherPreset].components.includes(componentId);
                });

                if (!neededByOtherPresets) {
                    autoActivatedComponents.delete(componentId);
                    checkbox.checked = false;
                    element.classList.remove('auto-selected');
                    showComponentQuantities(componentId, false);
                    updateAutoLabel(element, false);
                }
            });
        }

        calculateCost();
    }

    function toggleComponent(element, componentId) {
        const checkbox = element.querySelector('input[type="checkbox"]');
        if (!checkbox) return;

        checkbox.checked = !checkbox.checked;

        if (checkbox.checked) {
            if (autoActivatedComponents.has(componentId)) {
                element.classList.add('auto-selected');
                element.classList.remove('selected');
            } else {
                element.classList.add('selected');
                element.classList.remove('auto-selected');
            }
            showComponentQuantities(componentId, true);
        } else {
            element.classList.remove('selected', 'auto-selected');
            autoActivatedComponents.delete(componentId);
            showComponentQuantities(componentId, false);
            updateAutoLabel(element, false);
        }

        calculateCost();
    }

    function toggleService(element, serviceId) {
        const checkbox = element.querySelector('input[type="checkbox"]');
        if (!checkbox) return;

        checkbox.checked = !checkbox.checked;

        if (checkbox.checked) {
            if (autoActivatedServices.has(serviceId)) {
                element.classList.add('auto-selected');
                element.classList.remove('selected');
            } else {
                element.classList.add('selected');
                element.classList.remove('auto-selected');
            }
            showServiceQuantities(serviceId, true);
        } else {
            element.classList.remove('selected', 'auto-selected');
            autoActivatedServices.delete(serviceId);
            showServiceQuantities(serviceId, false);
            updateAutoLabel(element, false);
        }

        calculateCost();
    }

	function calculateCost() {
        const hourlyRate = safeGetValue('hourlyRate', 220);
        const lessonDuration = parseInt(safeGetValue('lessonDuration', 30));
        const simpleCalculation = safeGetElement('simpleCalculation')?.checked || false;
        const methodistRole = simpleCalculation ? 1.0 : safeGetValue('methodistRole', 1.0);
        const domainKnowledge = simpleCalculation ? 1.0 : safeGetValue('domainKnowledge', 1.0);
        const projectType = simpleCalculation ? 1.0 : safeGetValue('projectType', 1.0);
        const contentComplexity = simpleCalculation ? 1.0 : safeGetValue('contentComplexity', 1.2);
const urgency = simpleCalculation ? 1.0 : safeGetValue('urgency', 1.0);
const qualityLevel = simpleCalculation ? 1.0 : safeGetValue('qualityLevel', 1.0);
        const clientType = parseInt(safeGetValue('clientType', 20));

        // Расчет компонентов контента
        let componentCosts = [];
        let totalContentCost = 0;
        let totalContentHours = 0;

        // Проверка активных пресетов
        const activePresets = Object.keys(presets).filter(preset => {
            const count = parseInt(safeGetValue(preset + 'Preset', 0));
            return count > 0;
        });

        activePresets.forEach(presetType => {
            const count = parseInt(safeGetValue(presetType + 'Preset', 0));
            const presetDuration = parseInt(safeGetValue(presetType + 'Duration', presets[presetType].defaultDuration));
            const durationFactor = presetDuration / presets[presetType].defaultDuration;
            let baseHours = 0;

            presets[presetType].components.forEach(componentId => {
                const hours = safeGetValue(componentId + 'Hours', components[componentId]?.defaultHours || 1);
                baseHours += hours;
            });

            const complexityMultiplier = simpleCalculation ? 1.0 : calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
            const volumeDiscount = getVolumeDiscount(count);
const adjustedHours = baseHours * durationFactor * complexityMultiplier * qualityLevel * volumeDiscount;
            const cost = adjustedHours * count * hourlyRate;

            componentCosts.push({
                name: presets[presetType].name,
                count: count,
                hours: adjustedHours,
                cost: cost
            });

            totalContentCost += cost;
            totalContentHours += adjustedHours * count;
        });

        // Расчет отдельных компонентов (если не в пресетах)
        Object.keys(components).forEach(componentId => {
            const checkbox = safeGetElement(componentId);
            if (!checkbox?.checked) return;
            
            // Проверяем, не входит ли компонент в активные пресеты
            const isInActivePreset = activePresets.some(preset => 
                presets[preset].components.includes(componentId)
            );
            
            if (isInActivePreset) return;

            const count = parseInt(safeGetValue(componentId + 'Count', 1));
            const baseHours = safeGetValue(componentId + 'Hours', components[componentId].defaultHours);

            let volumeFactor = 1.0;
            if (componentId === 'longread') {
                const pages = safeGetValue('longreadPages', 1);
                volumeFactor = pages;
            } else if (componentId === 'quizzes') {
                const questions = parseInt(safeGetValue('quizzesQuestions', 7));
                volumeFactor = questions / 7;
            }

            const multiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
const volumeDiscount = getVolumeDiscount(count);
const adjustedHours = baseHours * volumeFactor * (lessonDuration / 60) * multiplier * qualityLevel * volumeDiscount;
            const cost = adjustedHours * count * hourlyRate;

            componentCosts.push({
                name: components[componentId].name,
                count: count,
                hours: adjustedHours,
                cost: cost
            });

            totalContentCost += cost;
            totalContentHours += adjustedHours * count;
        });

	// Расчет проверок знаний
        let assessmentCosts = [];
        let totalAssessmentCost = 0;
        let totalAssessmentHours = 0;

        Object.keys(assessments).forEach(serviceId => {
            const checkbox = safeGetElement(serviceId);
            if (!checkbox?.checked) return;
            
            const count = parseInt(safeGetValue(serviceId + 'Count', 1));
            const hours = safeGetValue(serviceId + 'Hours', assessments[serviceId].defaultHours);
            const multiplier = calculateAdaptiveMultiplier(domainKnowledge, projectType, contentComplexity, urgency, methodistRole);
const adjustedHours = hours * multiplier;
            const cost = adjustedHours * count * hourlyRate;

            assessmentCosts.push({
                name: assessments[serviceId].name,
                count: count,
                hours: adjustedHours,
                cost: cost
            });

            totalAssessmentCost += cost;
            totalAssessmentHours += adjustedHours * count;
        });

        // Расчет дополнительных услуг
        let serviceCosts = [];
        let totalServiceCost = 0;
        let totalServiceHours = 0;

        Object.keys(services).forEach(serviceId => {
            const checkbox = safeGetElement(serviceId);
            if (!checkbox?.checked) return;
            
            const hours = safeGetValue(serviceId + 'Hours', services[serviceId].defaultHours);
            const cost = hours * hourlyRate;

            serviceCosts.push({
                name: services[serviceId].name,
                count: 1,
                hours: hours,
                cost: cost
            });

            totalServiceCost += cost;
            totalServiceHours += hours;
        });

        // Расчет правок
const revisionFactor = clientType / 100;
const contentWithRevisions = totalContentCost * (1 + revisionFactor);
const assessmentsWithRevisions = totalAssessmentCost * (1 + revisionFactor);
const subtotalBeforeFinancials = contentWithRevisions + assessmentsWithRevisions + totalServiceCost;

// Применяем скидку/наценку к общей сумме
const discountRate = safeGetValue('discountRate', 0) / 100;
const discountAmount = subtotalBeforeFinancials * discountRate;
const afterDiscount = subtotalBeforeFinancials + discountAmount;

// Применяем налог к сумме после скидки
const taxRate = safeGetValue('taxRate', 13) / 100;
const taxAmount = afterDiscount * taxRate;
const totalCost = afterDiscount + taxAmount;

// Для совместимости с интерфейсом
const subtotal = subtotalBeforeFinancials;

// Расчет общего времени
const totalHours = totalContentHours + totalAssessmentHours + totalServiceHours;

// Обновление цен в пресетах и компонентах
updatePresetPrices();
updateComponentPrices();

        // Обновление интерфейса
        console.log('Financial data:', { subtotal, discountAmount, afterDiscount, taxAmount, discountRate: safeGetValue('discountRate', 0), taxRate: safeGetValue('taxRate', 13) });
updateResults(totalCost, totalHours, componentCosts, assessmentCosts, serviceCosts, activePresets, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount);
    }

    function updateResults(totalCost, totalHours, componentCosts, assessmentCosts, serviceCosts, activePresets, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount) {
        // Обновление основных результатов
        const totalCostElement = safeGetElement('totalCost');
        const totalHoursElement = safeGetElement('totalHours');
        
        if (totalCostElement) {
            totalCostElement.textContent = Math.round(totalCost).toLocaleString('ru-RU') + ' ₽';
        }
        
        if (totalHoursElement) {
            totalHoursElement.textContent = (Math.round(totalHours * 10) / 10) + ' ч';
        }

        // Обновление состава проекта
        updateProjectComposition(activePresets, componentCosts, assessmentCosts, serviceCosts);

        // Обновление детализации
        updateBreakdown(totalCost, componentCosts, assessmentCosts, serviceCosts, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount);
    }

    function updateProjectComposition(activePresets, componentCosts, assessmentCosts, serviceCosts) {
        const projectComposition = safeGetElement('projectComposition');
        if (!projectComposition) return;

        projectComposition.innerHTML = '';
        
        if (activePresets.length > 0 || componentCosts.length > 0 || assessmentCosts.length > 0 || serviceCosts.length > 0) {
            activePresets.forEach(preset => {
                const count = parseInt(safeGetValue(preset + 'Preset', 0));
                const duration = parseInt(safeGetValue(preset + 'Duration', presets[preset]?.defaultDuration || 30));
                const presetName = presets[preset]?.name || preset;
                projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + presetName + ' (' + count + ' шт., ' + duration + ' мин)</span></div>';
            });
            
            componentCosts.forEach(item => {
                const isInActivePreset = activePresets.some(preset => 
                    presets[preset]?.name === item.name
                );
                if (!isInActivePreset) {
                    projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span></div>';
                }
            });
            
            assessmentCosts.forEach(item => {
                projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span></div>';
            });
            
            serviceCosts.forEach(item => {
                projectComposition.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + '</span></div>';
            });
        } else {
            projectComposition.innerHTML = '<div style="color: #6b7280; font-style: italic;">Выберите компоненты или используйте пресеты</div>';
        }
    }

function updateBreakdown(totalCost, componentCosts, assessmentCosts, serviceCosts, revisionFactor, clientType, subtotal, discountAmount, afterDiscount, taxAmount) {
        const breakdown = safeGetElement('breakdown');
        if (!breakdown) return;

        breakdown.innerHTML = '';
        
        if (totalCost > 0) {
            // Показываем компоненты
            if (componentCosts.length > 0) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Контент</div>';
                componentCosts.forEach(item => {
                    const cost = Math.round(item.cost).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
                });
                breakdown.innerHTML += '</div>';
            }
            
            // Показываем проверки знаний
            if (assessmentCosts.length > 0) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Проверки знаний</div>';
                assessmentCosts.forEach(item => {
                    const cost = Math.round(item.cost).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + ' (' + item.count + ' шт.)</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
                });
                breakdown.innerHTML += '</div>';
            }
            
            // Показываем дополнительные услуги
            if (serviceCosts.length > 0) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Дополнительные услуги</div>';
                serviceCosts.forEach(item => {
                    const cost = Math.round(item.cost).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + item.name + '</span><span class="breakdown-right">' + cost + ' ₽</span></div>';
                });
                breakdown.innerHTML += '</div>';
            }
            
            // Показываем правки ТОЛЬКО если они есть
            if (revisionFactor > 0 && (componentCosts.length > 0 || assessmentCosts.length > 0)) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Правки</div>';
                
                if (componentCosts.length > 0) {
                    const totalContentCost = componentCosts.reduce((sum, item) => sum + item.cost, 0);
                    const revisionCost = Math.round(totalContentCost * revisionFactor).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Правки контента (' + clientType + '%)</span><span class="breakdown-right">+' + revisionCost + ' ₽</span></div>';
                }
                
                if (assessmentCosts.length > 0) {
                    const totalAssessmentCost = assessmentCosts.reduce((sum, item) => sum + item.cost, 0);
                    const revisionCost = Math.round(totalAssessmentCost * revisionFactor).toLocaleString('ru-RU');
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Правки проверок (' + clientType + '%)</span><span class="breakdown-right">+' + revisionCost + ' ₽</span></div>';
                }
                
                breakdown.innerHTML += '</div>';
            }
            
            // Показываем финансовые расчеты ТОЛЬКО если есть скидки или налоги
            const discountRate = safeGetValue('discountRate', 0);
            const taxRate = safeGetValue('taxRate', 13);
            const showTaxSeparately = safeGetElement('showTaxSeparately')?.checked || false;
            
            if (discountRate !== 0 || (taxRate > 0 && showTaxSeparately)) {
                breakdown.innerHTML += '<div class="breakdown-section"><div class="breakdown-section-title">Финансовые расчеты</div>';
                
                // Подытог
                breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Подытог</span><span class="breakdown-right">' + Math.round(subtotal).toLocaleString('ru-RU') + ' ₽</span></div>';
                
                // Скидка/наценка
                if (discountRate !== 0) {
                    const discountText = discountRate > 0 ? `Наценка (+${discountRate}%)` : `Скидка (${discountRate}%)`;
                    const discountSign = discountAmount > 0 ? '+' : '';
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + discountText + '</span><span class="breakdown-right">' + discountSign + Math.round(discountAmount).toLocaleString('ru-RU') + ' ₽</span></div>';
                }
                
                // Налог
                if (taxRate > 0 && showTaxSeparately) {
                    breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">Налог (' + taxRate + '%)</span><span class="breakdown-right">+' + Math.round(taxAmount).toLocaleString('ru-RU') + ' ₽</span></div>';
                }
                
                breakdown.innerHTML += '</div>';
            }
            
            // Итого
            const totalLabel = (taxRate > 0 && !showTaxSeparately) ? 'Итого (с налогом)' : 'Итого';
            breakdown.innerHTML += '<div class="breakdown-item"><span class="breakdown-left">' + totalLabel + '</span><span class="breakdown-right">' + Math.round(totalCost).toLocaleString('ru-RU') + ' ₽</span></div>';
        } else {
            breakdown.innerHTML = '<div style="color: #6b7280; font-style: italic;">Расчет появится после выбора компонентов</div>';
        }
    }     

    // Добавление обработчиков событий
    function initializeEventListeners() {
        // Обработчик для слайдера длительности урока
        const lessonDurationInput = safeGetElement('lessonDuration');
        if (lessonDurationInput) {
            lessonDurationInput.addEventListener('input', () => {
                updateLessonDurationDisplay();
                calculateCost();
            });
        }

        // Обработчики для основных параметров
        const basicInputs = ['hourlyRate', 'simpleCalculation', 'methodistRole', 'domainKnowledge', 'projectType', 'contentComplexity', 'urgency', 'qualityLevel', 'clientType', 'showTaxSeparately'];
        basicInputs.forEach(inputId => {
            const element = safeGetElement(inputId);
            if (element) {
                element.addEventListener('input', () => {
                    handleAutoActivation();
                    calculateCost();
                });
                element.addEventListener('change', () => {
                    handleAutoActivation();
                    calculateCost();
                });
            }
        });

// Обработчики для финансовых ползунков
const discountSlider = safeGetElement('discountRate');
if (discountSlider) {
    discountSlider.addEventListener('input', () => {
        updateDiscountDisplay();
        calculateCost();
    });
    
    discountSlider.addEventListener('mouseenter', () => showTooltip('discountTooltip'));
    discountSlider.addEventListener('mouseleave', () => hideTooltip('discountTooltip'));
    discountSlider.addEventListener('focus', () => showTooltip('discountTooltip'));
    discountSlider.addEventListener('blur', () => hideTooltip('discountTooltip'));
}

const taxSlider = safeGetElement('taxRate');
if (taxSlider) {
    taxSlider.addEventListener('input', () => {
        updateTaxDisplay();
        calculateCost();
    });
    
    taxSlider.addEventListener('mouseenter', () => showTooltip('taxTooltip'));
    taxSlider.addEventListener('mouseleave', () => hideTooltip('taxTooltip'));
    taxSlider.addEventListener('focus', () => showTooltip('taxTooltip'));
    taxSlider.addEventListener('blur', () => hideTooltip('taxTooltip'));
}

        // Обработчики для пресетов
        document.querySelectorAll('.preset-item').forEach(preset => {
            const presetType = preset.getAttribute('data-preset');
            if (!presetType) return;
            
            // Клик по самому пресету
            preset.addEventListener('click', (e) => {
                // Проверяем, что клик не по input полю
                if (e.target.tagName === 'INPUT') return;
                
                const countInput = safeGetElement(presetType + 'Preset');
                if (countInput) {
                    const currentCount = parseInt(countInput.value) || 0;
                    countInput.value = currentCount === 0 ? 1 : 0;
                    applyPreset(presetType);
updatePresetPrices();
                }
            });

            // Обработчики для input полей в пресетах
            preset.querySelectorAll('.preset-quantity-input').forEach(input => {
                input.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                input.addEventListener('input', () => {
                    applyPreset(presetType);
                });
            });
        });

        // Обработчики для компонентов
        document.querySelectorAll('.component-item').forEach(item => {
            const componentId = item.getAttribute('data-component');
            if (!componentId) return;
            
            // Клик по компоненту
            item.addEventListener('click', (e) => {
                // Проверяем, что клик не по input полю
                if (e.target.tagName === 'INPUT') return;
                
                toggleComponent(item, componentId);
            });

            // Обработчики для input полей в компонентах
            item.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                input.addEventListener('input', () => {
    if (input.id.includes('Hours')) {
        const displayElement = safeGetElement(componentId + 'HoursDisplay');
        if (displayElement) {
            displayElement.textContent = parseFloat(input.value).toFixed(1) + 'ч/шт';
        }
        updateComponentPrices();
    }
    calculateCost();
});
            });

            // Обработчик для чекбокса
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        item.classList.add('selected');
                        showComponentQuantities(componentId, true);
                    } else {
                        item.classList.remove('selected', 'auto-selected');
                        autoActivatedComponents.delete(componentId);
                        showComponentQuantities(componentId, false);
                        updateAutoLabel(item, false);
                    }
                    calculateCost();
                });
            }
        });

        // Обработчики для услуг
        document.querySelectorAll('.service-item').forEach(item => {
            const serviceId = item.getAttribute('data-service');
            if (!serviceId) return;
            
            // Клик по услуге
            item.addEventListener('click', (e) => {
                // Проверяем, что клик не по input полю
                if (e.target.tagName === 'INPUT') return;
                
                toggleService(item, serviceId);
            });

            // Обработчики для input полей в услугах
            item.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                input.addEventListener('input', () => {
                    if (input.id.includes('Hours')) {
                        const displayElement = safeGetElement(serviceId + 'HoursDisplay');
                        if (displayElement) {
                            const suffix = assessments[serviceId] ? 'ч/шт' : 'ч';
                            displayElement.textContent = parseFloat(input.value).toFixed(1) + suffix;
                        }
                    }
                    calculateCost();
                });
            });

            // Обработчик для чекбокса
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        item.classList.add('selected');
                        showServiceQuantities(serviceId, true);
                    } else {
                        item.classList.remove('selected', 'auto-selected');
                        autoActivatedServices.delete(serviceId);
                        showServiceQuantities(serviceId, false);
                        updateAutoLabel(item, false);
                    }
                    calculateCost();
                });
            }
        });
    }

// Функция генерации текста для клиента
function generateClientText() {
    const hourlyRate = safeGetValue('hourlyRate', 220);
    const totalCostElement = safeGetElement('totalCost');
    const totalHoursElement = safeGetElement('totalHours');
    
    if (!totalCostElement || !totalHoursElement) return '';
    
    const totalCost = totalCostElement.textContent;
    const totalHours = totalHoursElement.textContent;
    
    let text = `РАСЧЕТ СТОИМОСТИ МЕТОДИЧЕСКИХ УСЛУГ\n`;
    text += `Дата: ${new Date().toLocaleDateString('ru-RU')}\n\n`;
    
    // Состав проекта
    const projectComposition = safeGetElement('projectComposition');
    if (projectComposition && projectComposition.innerHTML.trim() && !projectComposition.innerHTML.includes('italic')) {
        text += `СОСТАВ ПРОЕКТА:\n`;
        const items = projectComposition.querySelectorAll('.breakdown-item .breakdown-left');
        items.forEach(item => {
            text += `• ${item.textContent}\n`;
        });
        text += `\n`;
    }
    
    // Детализация
    const breakdown = safeGetElement('breakdown');
    if (breakdown && breakdown.innerHTML.trim() && !breakdown.innerHTML.includes('italic')) {
        text += `ДЕТАЛЬНАЯ СМЕТА:\n\n`;
        
        const sections = breakdown.querySelectorAll('.breakdown-section');
        sections.forEach(section => {
            const title = section.querySelector('.breakdown-section-title');
            if (title) {
                text += `${title.textContent.toUpperCase()}:\n`;
                const items = section.querySelectorAll('.breakdown-item');
                items.forEach(item => {
                    const left = item.querySelector('.breakdown-left');
                    const right = item.querySelector('.breakdown-right');
                    if (left && right) {
                        text += `  ${left.textContent} — ${right.textContent}\n`;
                    }
                });
                text += `\n`;
            }
        });
        
        // Итого
        const totalItem = breakdown.querySelector('.breakdown-item:last-child');
        if (totalItem) {
            const left = totalItem.querySelector('.breakdown-left');
            const right = totalItem.querySelector('.breakdown-right');
            if (left && right) {
                text += `${left.textContent.toUpperCase()}: ${right.textContent}\n`;
            }
        }
    }
    
    text += `\nОБЩИЕ ПОКАЗАТЕЛИ:\n`;
    text += `• Общее время выполнения: ${totalHours}\n`;
    text += `• Итоговая стоимость: ${totalCost}\n\n`;
    
    text += `УСЛОВИЯ:\n`;
    text += `• Часовая ставка: ${hourlyRate} ₽/час\n`;
    text += `• Оплата по факту выполнения этапов\n`;
    text += `• Сроки уточняются при заключении договора\n`;
    text += `• Стоимость действительна в течение 30 дней\n\n`;
    
    text += `Данный расчет носит предварительный характер.\n`;
    text += `Финальная стоимость может быть скорректирована после детального обсуждения требований.`;
    
    return text;
}

// Функция копирования в буфер обмена
function copyCalculationToClipboard() {
    const text = generateClientText();
    
    if (!text) {
        alert('Сначала настройте параметры и выберите компоненты');
        return;
    }
    
    navigator.clipboard.writeText(text).then(() => {
        const status = safeGetElement('copyStatus');
        if (status) {
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
    }).catch(err => {
        console.error('Ошибка копирования: ', err);
        // Fallback для старых браузеров
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const status = safeGetElement('copyStatus');
        if (status) {
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
    });
}

    // Инициализация приложения
    function initialize() {
        updateLessonDurationDisplay();
        initializeEventListeners();
        handleAutoActivation();
        updateDiscountDisplay();
updateTaxDisplay();
updateComponentPrices();
calculateCost();
    }

    // Запуск после загрузки DOM
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
</script>
    
</body>
</html>
